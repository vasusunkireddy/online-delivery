<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delicute - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: url('https://images.unsplash.com/photo-1515003197210-e0cd71810b5f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80') no-repeat center center fixed;
            background-size: cover;
            color: #1f2937;
            margin: 0;
            position: relative;
            min-height: 100vh;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: -1;
        }
        .auth-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            padding: 1.5rem;
            max-width: 1400px;
            width: 95%;
            margin: 1.5rem auto;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .auth-container:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        .input-field {
            transition: all 0.3s ease;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            padding: 0.5rem;
            background: white;
            width: 100%;
            font-size: 0.875rem;
        }
        .input-field:focus {
            border-color: #f59e0b;
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2);
            outline: none;
        }
        .auth-btn {
            background: linear-gradient(90deg, #f59e0b, #f97316);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            border-radius: 6px;
            padding: 0.5rem 1rem;
            font-weight: 500;
            color: white;
            font-size: 0.875rem;
        }
        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(245, 158, 11, 0.3);
            background: linear-gradient(90deg, #f97316, #f59e0b);
        }
        .auth-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.4s ease, height 0.4s ease;
        }
        .auth-btn:hover::after {
            width: 200px;
            height: 200px;
        }
        .toast {
            position: fixed;
            top: 16px;
            right: 16px;
            padding: 0.75rem 1rem;
            border-radius: 6px;
            color: white;
            z-index: 1000;
            display: none;
            min-width: 160px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            animation: slideIn 0.3s ease;
        }
        .toast.success {
            background: linear-gradient(90deg, #22c55e, #16a34a);
        }
        .toast.error {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .table-container {
            max-height: 360px;
            overflow-y: auto;
            border-radius: 6px;
            background: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .table-container table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        .table-container th, .table-container td {
            padding: 0.5rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.75rem;
        }
        .table-container th {
            background: #f9fafb;
            position: sticky;
            top: 0;
            z-index: 10;
            font-weight: 600;
        }
        .profile-container {
            position: relative;
        }
        .profile-img {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid #f59e0b;
            transition: transform 0.3s ease;
        }
        .profile-img:hover {
            transform: scale(1.1);
        }
        .dropdown-menu {
            display: none;
            position: absolute;
            top: 40px;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            min-width: 160px;
            z-index: 100;
            overflow: hidden;
        }
        .dropdown-menu.active {
            display: block;
            animation: dropdown 0.3s ease;
        }
        @keyframes dropdown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .dropdown-item {
            padding: 0.5rem 0.75rem;
            color: #1f2937;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .dropdown-item:hover {
            background: #f59e0b;
            color: white;
        }
        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 0.75rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        .home-bg {
            background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
            border-radius: 12px;
            padding: 1.5rem;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        .home-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://images.unsplash.com/photo-1504674900247-0877df9cc836?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80') no-repeat center center;
            background-size: cover;
            opacity: 0.2;
            z-index: 0;
        }
        .home-bg > * {
            position: relative;
            z-index: 1;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .modal-content {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            max-width: 95%;
            width: 400px;
            position: relative;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
            animation: modalPop 0.3s ease;
        }
        @keyframes modalPop {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .close-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 1rem;
            cursor: pointer;
            color: #374151;
            transition: color 0.2s ease;
        }
        .close-btn:hover {
            color: #f59e0b;
        }
        .menu-img {
            width: 36px;
            height: 36px;
            object-fit: cover;
            border-radius: 6px;
            border: 2px solid #f59e0b;
        }
        .contact-message {
            background: #f9fafb;
            padding: 0.75rem;
            border-radius: 6px;
            margin-bottom: 0.75rem;
            word-break: break-word;
            font-size: 0.75rem;
        }
        .navbar-menu {
            transition: max-height 0.3s ease-in-out;
        }
        @media (max-width: 768px) {
            .auth-container {
                padding: 1rem;
                margin: 1rem auto;
            }
            .table-container {
                overflow-x: auto;
            }
            .table-container table {
                min-width: 600px;
            }
            .stat-card {
                padding: 0.5rem;
            }
            .stat-card h3 {
                font-size: 0.75rem;
            }
            .stat-card p {
                font-size: 1rem;
            }
            .modal-content {
                width: 95%;
                padding: 0.75rem;
            }
            .dropdown-menu {
                min-width: 140px;
            }
            .dropdown-item {
                font-size: 0.75rem;
                padding: 0.5rem;
            }
            .auth-btn {
                padding: 0.5rem 0.75rem;
                font-size: 0.75rem;
            }
            .input-field {
                padding: 0.5rem;
                font-size: 0.75rem;
            }
            .navbar-menu {
                max-height: 0;
                overflow: hidden;
            }
            .navbar-menu.active {
                max-height: 400px;
            }
        }
        @media (min-width: 769px) {
            .auth-container {
                padding: 2rem;
                margin: 2rem auto;
            }
            .table-container th, .table-container td {
                padding: 0.75rem;
                font-size: 0.875rem;
            }
            .menu-img {
                width: 48px;
                height: 48px;
            }
            .profile-img {
                width: 40px;
                height: 40px;
            }
            .modal-content {
                padding: 1.5rem;
                width: 500px;
            }
            .auth-btn {
                padding: 0.75rem 1.5rem;
                font-size: 0.875rem;
            }
            .input-field {
                padding: 0.75rem;
                font-size: 0.875rem;
            }
        }
    </style>
</head>
<body>
    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('profileModal')">×</span>
            <h2 class="text-lg sm:text-xl font-bold text-gray-800 text-center mb-4">Admin Profile</h2>
            <div class="flex justify-center mb-4">
                <img id="modalProfileImage" src="https://via.placeholder.com/80" alt="Profile" class="w-16 h-16 sm:w-20 sm:h-20 rounded-full border-2 border-yellow-500 object-cover">
            </div>
            <div>
                <label for="profileName" class="block text-sm text-gray-700 font-medium mb-1">Name</label>
                <input type="text" id="profileName" class="input-field" readonly>
            </div>
            <div class="mt-3">
                <label for="profileEmail" class="block text-sm text-gray-700 font-medium mb-1">Email</label>
                <input type="email" id="profileEmail" class="input-field" readonly>
            </div>
            <div class="mt-3">
                <label for="profilePhone" class="block text-sm text-gray-700 font-medium mb-1">Phone Number</label>
                <input type="tel" id="profilePhone" class="input-field" readonly>
            </div>
            <div class="mt-3">
                <label for="profileImageUpload" class="block text-sm text-gray-700 font-medium mb-1">Upload Profile Image</label>
                <input type="file" id="profileImageUpload" class="input-field" accept="image/*">
            </div>
            <div class="mt-4">
                <button onclick="updateProfileImage()" class="auth-btn w-full">Update Profile Image</button>
            </div>
        </div>
    </div>

    <!-- Edit Menu Item Modal -->
    <div id="editMenuModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('editMenuModal')">×</span>
            <h2 class="text-lg sm:text-xl font-bold text-gray-800 text-center mb-4">Edit Menu Item</h2>
            <input type="hidden" id="editItemId">
            <div class="grid grid-cols-1 gap-3">
                <div>
                    <label for="editItemName" class="block text-sm text-gray-700 font-medium mb-1">Item Name</label>
                    <input type="text" id="editItemName" class="input-field" placeholder="Item Name">
                </div>
                <div>
                    <label for="editItemPrice" class="block text-sm text-gray-700 font-medium mb-1">Price (₹)</label>
                    <input type="number" id="editItemPrice" class="input-field" placeholder="Price" step="0.01" min="0">
                </div>
                <div>
                    <label for="editItemCategory" class="block text-sm text-gray-700 font-medium mb-1">Category</label>
                    <select id="editItemCategory" class="input-field">
                        <option value="">Select Category</option>
                        <option value="Veg Pizza">Veg Pizza</option>
                        <option value="Non-Veg Pizza">Non-Veg Pizza</option>
                        <option value="Mocktails">Mocktails</option>
                        <option value="Juice">Juice</option>
                        <option value="Maggie">Maggie</option>
                        <option value="Pasta">Pasta</option>
                        <option value="Shakes">Shakes</option>
                        <option value="Waffles">Waffles</option>
                        <option value="French Fries">French Fries</option>
                        <option value="Desserts">Desserts</option>
                    </select>
                </div>
                <div>
                    <label for="editItemImage" class="block text-sm text-gray-700 font-medium mb-1">Image URL (Optional)</label>
                    <input type="text" id="editItemImage" class="input-field" placeholder="Image URL">
                </div>
                <div>
                    <label for="editItemImageUpload" class="block text-sm text-gray-700 font-medium mb-1">Upload Image (Optional)</label>
                    <input type="file" id="editItemImageUpload" class="input-field" accept="image/*">
                </div>
                <div>
                    <label for="editItemDescription" class="block text-sm text-gray-700 font-medium mb-1">Description (Optional)</label>
                    <textarea id="editItemDescription" class="input-field" rows="3" placeholder="Item Description"></textarea>
                </div>
            </div>
            <div class="mt-4">
                <button onclick="updateMenuItem()" class="auth-btn w-full">Update Item</button>
            </div>
        </div>
    </div>

    <!-- Edit Offer Modal -->
    <div id="editOfferModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('editOfferModal')">×</span>
            <h2 class="text-lg sm:text-xl font-bold text-gray-800 text-center mb-4">Edit Special Offer</h2>
            <input type="hidden" id="editOfferId">
            <div class="grid grid-cols-1 gap-3">
                <div>
                    <label for="editOfferName" class="block text-sm text-gray-700 font-medium mb-1">Offer Name</label>
                    <input type="text" id="editOfferName" class="input-field" placeholder="Offer Name">
                </div>
                <div>
                    <label for="editOfferPrice" class="block text-sm text-gray-700 font-medium mb-1">Price (₹)</label>
                    <input type="number" id="editOfferPrice" class="input-field" placeholder="Price" step="0.01" min="0">
                </div>
                <div>
                    <label for="editOfferImage" class="block text-sm text-gray-700 font-medium mb-1">Image URL (Optional)</label>
                    <input type="text" id="editOfferImage" class="input-field" placeholder="Image URL">
                </div>
                <div>
                    <label for="editOfferImageUpload" class="block text-sm text-gray-700 font-medium mb-1">Upload Image (Optional)</label>
                    <input type="file" id="editOfferImageUpload" class="input-field" accept="image/*">
                </div>
                <div>
                    <label for="editOfferDescription" class="block text-sm text-gray-700 font-medium mb-1">Description (Optional)</label>
                    <textarea id="editOfferDescription" class="input-field" rows="3" placeholder="Offer Description"></textarea>
                </div>
            </div>
            <div class="mt-4">
                <button onclick="updateOffer()" class="auth-btn w-full">Update Offer</button>
            </div>
        </div>
    </div>

    <!-- Edit Coupon Modal -->
    <div id="editCouponModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('editCouponModal')">×</span>
            <h2 class="text-lg sm:text-xl font-bold text-gray-800 text-center mb-4">Edit Coupon</h2>
            <input type="hidden" id="editCouponId">
            <div class="grid grid-cols-1 gap-3">
                <div>
                    <label for="editCouponCode" class="block text-sm text-gray-700 font-medium mb-1">Coupon Code</label>
                    <input type="text" id="editCouponCode" class="input-field" placeholder="e.g., DELICUTE10">
                </div>
                <div>
                    <label for="editCouponDiscount" class="block text-sm text-gray-700 font-medium mb-1">Discount (%)</label>
                    <input type="number" id="editCouponDiscount" class="input-field" placeholder="Discount Percentage" min="1" max="100" step="1">
                </div>
                <div>
                    <label for="editCouponImage" class="block text-sm text-gray-700 font-medium mb-1">Image URL (Optional)</label>
                    <input type="text" id="editCouponImage" class="input-field" placeholder="Image URL">
                </div>
                <div>
                    <label for="editCouponImageUpload" class="block text-sm text-gray-700 font-medium mb-1">Upload Image (Optional)</label>
                    <input type="file" id="editCouponImageUpload" class="input-field" accept="image/*">
                </div>
                <div>
                    <label for="editCouponDescription" class="block text-sm text-gray-700 font-medium mb-1">Description (Optional)</label>
                    <textarea id="editCouponDescription" class="input-field" rows="3" placeholder="Coupon Description"></textarea>
                </div>
            </div>
            <div class="mt-4">
                <button onclick="updateCoupon()" class="auth-btn w-full">Update Coupon</button>
            </div>
        </div>
    </div>

    <!-- Customer Details Modal -->
    <div id="customerDetailsModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('customerDetailsModal')">×</span>
            <h2 class="text-lg sm:text-xl font-bold text-gray-800 text-center mb-4">Customer Details</h2>
            <div class="text-sm">
                <p><strong>Name:</strong> <span id="customerName"></span></p>
                <p class="mt-2"><strong>Email:</strong> <span id="customerEmail"></span></p>
                <p class="mt-2"><strong>Phone:</strong> <span id="customerPhone"></span></p>
                <p class="mt-2"><strong>Status:</strong> <span id="customerStatus"></span></p>
            </div>
            <div class="mt-3">
                <h3 class="text-sm font-medium text-gray-700 mb-2">Order History</h3>
                <div id="customerOrderHistory" class="table-container"></div>
            </div>
            <div class="mt-4 flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3">
                <button id="blockUnblockBtn" class="auth-btn px-3 py-1.5"></button>
                <button onclick="closeModal('customerDetailsModal')" class="auth-btn bg-gray-500 hover:bg-gray-600 px-3 py-1.5">Close</button>
            </div>
        </div>
    </div>

    <!-- Reply to Contact Message Modal -->
    <div id="replyContactModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('replyContactModal')">×</span>
            <h2 class="text-lg sm:text-xl font-bold text-gray-800 text-center mb-4">Reply to Message</h2>
            <input type="hidden" id="contactMessageId">
            <div>
                <label for="contactReplySubject" class="block text-sm text-gray-700 font-medium mb-1">Subject</label>
                <input type="text" id="contactReplySubject" class="input-field" placeholder="Reply Subject">
            </div>
            <div class="mt-3">
                <label for="contactReplyMessage" class="block text-sm text-gray-700 font-medium mb-1">Reply Message</label>
                <textarea id="contactReplyMessage" class="input-field" rows="4" placeholder="Your reply..."></textarea>
            </div>
            <div class="mt-4 flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3">
                <button onclick="sendReply()" class="auth-btn w-full">Send Reply</button>
                <button onclick="closeModal('replyContactModal')" class="auth-btn bg-gray-500 hover:bg-gray-600 w-full">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Navbar -->
    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <img src="https://i.postimg.cc/zv19J0xv/Zbhz-Fq-T-Imgur.jpg" alt="Delicute Logo" class="h-8 sm:h-10">
                    <div>
                        <h1 class="text-lg sm:text-xl font-bold text-gray-800">DELICUTE</h1>
                        <p class="text-xs text-gray-500">Admin Panel</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <span id="welcomeMessage" class="text-xs sm:text-sm text-gray-600 font-medium hidden sm:block"></span>
                    <div class="flex items-center sm:hidden">
                        <button id="menuToggle" class="text-gray-600 hover:text-gray-900 focus:outline-none" aria-label="Toggle menu">
                            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="hidden sm:flex profile-container">
                        <img id="profileImage" src="https://via.placeholder.com/40" alt="Profile" class="profile-img" onclick="toggleDropdown()" aria-label="Profile menu">
                        <div id="profileDropdown" class="dropdown-menu">
                            <div class="dropdown-item" onclick="showSection('home')">Home</div>
                            <div class="dropdown-item" onclick="showSection('profile')">Profile</div>
                            <div class="dropdown-item" onclick="showSection('menu')">Menu</div>
                            <div class="dropdown-item" onclick="showSection('orders')">Orders</div>
                            <div class="dropdown-item" onclick="showSection('offers')">Special Offers</div>
                            <div class="dropdown-item" onclick="showSection('coupons')">Coupons</div>
                            <div class="dropdown-item" onclick="showSection('customers')">Customers</div>
                            <div class="dropdown-item" onclick="showSection('contact')">Contact Messages</div>
                            <div class="dropdown-item" onclick="logout()">Logout</div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="navbarMenu" class="navbar-menu sm:hidden">
                <div class="flex flex-col space-y-2 px-4 py-2">
                    <div class="dropdown-item" onclick="showSection('home')">Home</div>
                    <div class="dropdown-item" onclick="showSection('profile')">Profile</div>
                    <div class="dropdown-item" onclick="showSection('menu')">Menu</div>
                    <div class="dropdown-item" onclick="showSection('orders')">Orders</div>
                    <div class="dropdown-item" onclick="showSection('offers')">Special Offers</div>
                    <div class="dropdown-item" onclick="showSection('coupons')">Coupons</div>
                    <div class="dropdown-item" onclick="showSection('customers')">Customers</div>
                    <div class="dropdown-item" onclick="showSection('contact')">Contact Messages</div>
                    <div class="dropdown-item" onclick="logout()">Logout</div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Dashboard -->
    <div class="auth-container">
        <!-- Home Section -->
        <section id="homeSection" class="home-bg mb-6">
            <h2 class="text-lg sm:text-2xl font-bold text-center mb-4">Welcome to Delicute Admin Panel</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
                <div class="stat-card">
                    <h3 class Ost-md">Total Orders</h3>
                    <p id="totalOrders" class="text-lg sm:text-2xl font-bold text-yellow-600 mt-1">0</p>
                </div>
                <div class="stat-card">
                    <h3 class="text-sm font-medium text-gray-600">Menu Items</h3>
                    <p id="totalMenuItems" class="text-lg sm:text-2xl font-bold text-yellow-600 mt-1">0</p>
                </div>
                <div class="stat-card">
                    <h3 class="text-sm font-medium text-gray-600">Pending Orders</h3>
                    <p id="pendingOrders" class="text-lg sm:text-2xl font-bold text-yellow-600 mt-1">0</p>
                </div>
                <div class="stat-card">
                    <h3 class="text-sm font-medium text-gray-600">Restaurant Status</h3>
                    <p id="restaurantStatus" class="text-lg sm:text-2xl font-bold text-yellow-600 mt-1">Closed</p>
                    <button onclick="toggleRestaurantStatus()" id="statusToggleBtn" class="auth-btn px-3 py-1 mt-2">Open Restaurant</button>
                </div>
            </div>
        </section>

        <!-- Profile Section -->
        <section id="profileSection" class="hidden mb-6">
            <h3 class="text-lg sm:text-2xl font-semibold text-gray-800 mb-4">Admin Profile</h3>
            <div class="bg-white p-4 sm:p-6 rounded-lg shadow-md">
                <div class="flex justify-center mb-3">
                    <img id="displayProfileImage" src="https://via.placeholder.com/80" alt="Profile" class="w-12 h-12 sm:w-20 sm:h-20 rounded-lg border-2 border-yellow-600 object-cover">
                </div>
                <div class="text-sm">
                    <p><strong>Name:</strong> <span id="displayProfileName"></span></p>
                    <p class="mt-2"><strong>Email:</strong> <span id="displayProfileEmail"></span></p>
                    <p class="mt-2"><strong>Phone:</strong> <span id="displayProfilePhone"></span></p>
                </div>
                <div class="mt-4 flex justify-center">
                    <button onclick="showModal('profileModal')" class="auth-btn px-4 py-2">Edit Profile Image</button>
                </div>
            </div>
        </section>

        <!-- Menu Management Section -->
        <section id="menuSection" class="hidden mb-6">
            <h3 class="text-lg sm:text-2xl font-semibold text-gray-800 mb-4">Manage Menu</h3>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                <!-- Add Menu Item Form -->
                <div class="bg-white p-4 sm:p-6 rounded-lg shadow-md lg:col-span-1">
                    <h4 class="text-base sm:text-lg font-medium text-gray-600 mb-4">Add New Menu Item</h4>
                    <div class="grid grid-cols-1 gap-3">
                        <div>
                            <label for="itemName" class="block text-sm font-medium text-gray-700 mb-1">Item Name</label>
                            <input type="text" id="itemName" class="input-field" placeholder="Item Name">
                        </div>
                        <div>
                            <label for="itemPrice" class="block text-sm font-medium text-gray-700 mb-1">Price (₹)</label>
                            <input type="number" id="itemPrice" class="input-field" placeholder="Price" step="0.01" min="0">
                        </div>
                        <div>
                            <label for="itemCategory" class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                            <select id="itemCategory" class="input-field">
                                <option value="">Select Category</option>
                                <option value="Veg Pizza">Veg Pizza</option>
                                <option value="Non-Veg Pizza">Non-Veg Pizza</option>
                                <option value="Mocktails">Mocktails</option>
                                <option value="Juice">Juice</option>
                                <option value="Maggie">Maggie</option>
                                <option value="Pasta">Pasta</option>
                                <option value="Shakes">Shakes</option>
                                <option value="Waffles">Waffles</option>
                                <option value="French Fries">French Fries</option>
                                <option value="Desserts">Desserts</option>
                            </select>
                        </div>
                        <div>
                            <label for="itemImage" class="block text-sm font-medium text-gray-700 mb-1">Image URL (Optional)</label>
                            <input type="text" id="itemImage" class="input-field" placeholder="Image URL">
                        </div>
                        <div>
                            <label for="itemImageUpload" class="block text-sm font-medium text-gray-700 mb-1">Upload Image (Optional)</label>
                            <input type="file" id="itemImageUpload" class="input-field" accept="image/*">
                        </div>
                        <div>
                            <label for="itemDescription" class="block text-sm font-medium text-gray-700 mb-1">Description (Optional)</label>
                            <textarea id="itemDescription" class="input-field" rows="3" placeholder="Description"></textarea>
                        </div>
                        <button onclick="addMenuItem()" class="auth-btn mt-3">Add Item</button>
                    </div>
                </div>
                <!-- Menu Items Table -->
                <div class="bg-white p-4 sm:p-6 rounded-lg shadow-md lg:col-span-2">
                    <h4 class="text-base sm:text-lg font-medium text-gray-600 mb-2">Menu Items</h4>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Image</th>
                                    <th>Name</th>
                                    <th>Category</th>
                                    <th>Price</th>
                                    <th>Description</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="menuTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Order Management Section -->
        <section id="ordersSection" class="hidden mb-6">
            <h3 class="text-lg sm:text-2xl font-semibold text-gray-800 mb-4">Order Management</h3>
            <div class="bg-white p-4 sm:p-6 rounded-lg shadow-md">
                <h4 class="text-base sm:text-lg font-medium text-gray-600 mb-2">Orders</h4>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Payment</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="orderTableBody"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Special Offers Section -->
        <section id="offersSection" class="hidden mb-6">
            <h3 class="text-lg sm:text-2xl font-semibold text-gray-800 mb-4">Manage Special Offers</h3>
            <div class="bg-white p-4 sm:p-6 rounded-lg shadow-md mb-4">
                <h4 class="text-base sm:text-lg font-medium text-gray-600 mb-4">Add New Offer</h4>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div>
                        <label for="offerName" class="block text-sm font-medium text-gray-700 mb-1">Offer Name</label>
                        <input type="text" id="offerName" class="input-field" placeholder="Offer Name">
                    </div>
                    <div>
                        <label for="offerPrice" class="block text-sm font-medium text-gray-700 mb-1">Price (₹)</label>
                        <input type="number" id="offerPrice" class="input-field" placeholder="Price" step="0.01" min="0">
                    </div>
                    <div>
                        <label for="offerImage" class="block text-sm font-medium text-gray-700 mb-1">Image URL (Optional)</label>
                        <input type="text" id="offerImage" class="input-field" placeholder="Image URL">
                    </div>
                    <div>
                        <label for="offerImageUpload" class="block text-sm font-medium text-gray-700 mb-1">Upload Image (Optional)</label>
                        <input type="file" id="offerImageUpload" class="input-field" accept="image/*">
                    </div>
                    <div class="sm:col-span-2">
                        <label for="offerDescription" class="block text-sm font-medium text-gray-700 mb-1">Description (Optional)</label>
                        <textarea id="offerDescription" class="input-field" rows="3" placeholder="Description"></textarea>
                    </div>
                </div>
                <div class="mt-3">
                    <button onclick="addOffer()" class="auth-btn w-full">Add Offer</button>
                </div>
            </div>
            <div class="bg-white p-4 sm:p-6 rounded-lg shadow-md">
                <h4 class="text-base sm:text-lg font-medium text-gray-600 mb-2">Special Offers</h4>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Name</th>
                                <th>Price</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="offerTableBody"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Coupons Management Section -->
        <section id="couponsSection" class="hidden mb-6">
            <h3 class="text-lg sm:text-2xl font-semibold text-gray-800 mb-4">Manage Coupons</h3>
            <div class="bg-white p-4 sm:p-6 rounded-lg shadow-md mb-4">
                <h4 class="text-base sm:text-lg font-medium text-gray-600 mb-4">Add New Coupon</h4>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div>
                        <label for="couponCode" class="block text-sm font-medium text-gray-700 mb-1">Coupon Code</label>
                        <input type="text" id="couponCode" class="input-field" placeholder="e.g., DELICUTE10">
                    </div>
                    <div>
                        <label for="couponDiscount" class="block text-sm font-medium text-gray-700 mb-1">Discount (%)</label>
                        <input type="number" id="couponDiscount" class="input-field" placeholder="Discount Percentage" min="1" max="100" step="1">
                    </div>
                    <div>
                        <label for="couponImage" class="block text-sm font-medium text-gray-700 mb-1">Image URL (Optional)</label>
                        <input type="text" id="couponImage" class="input-field" placeholder="Image URL">
                    </div>
                    <div>
                        <label for="couponImageUpload" class="block text-sm font-medium text-gray-700 mb-1">Upload Image (Optional)</label>
                        <input type="file" id="couponImageUpload" class="input-field" accept="image/*">
                    </div>
                    <div class="sm:col-span-2">
                        <label for="couponDescription" class="block text-sm font-medium text-gray-700 mb-1">Description (Optional)</label>
                        <textarea id="couponDescription" class="input-field" rows="3" placeholder="Description"></textarea>
                    </div>
                </div>
                <div class="mt-3">
                    <button onclick="addCoupon()" class="auth-btn w-full">Add Coupon</button>
                </div>
            </div>
            <div class="bg-white p-4 sm:p-6 rounded-lg shadow-md">
                <h4 class="text-base sm:text-lg font-medium text-gray-600">Coupons</h4>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Code</th>
                                <th>Discount (%)</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="couponTableBody"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Customer Management Section -->
        <section id="customersSection" class="hidden mb-6">
            <h3 class="text-lg sm:text-2xl font-semibold text-gray-800 mb-4">Manage Customers</h3>
            <div class="bg-white p-4 sm:p-6 rounded-lg shadow-md">
                <h4 class="text-base sm:text-lg font-medium text-gray-600 mb-2">Customers</h4>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="customerTableBody"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Contact Messages Section -->
        <section id="contactSection" class="hidden mb-6">
            <h3 class="text-lg sm:text-2xl font-semibold text-gray-800 mb-4">Manage Contact Messages</h3>
            <div class="bg-white p-4 sm:p-6 rounded-lg shadow-md">
                <h4 class="text-base sm:text-lg font-medium text-gray-600 mb-2">Messages</h4>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Subject</th>
                                <th>Message</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="contactTableBody"></tbody>
                    </table>
                </div>
            </div>
        </section>
    </div>

    <script>
        const BASE_URL = window.location.hostname === 'localhost' ? 'http://localhost:3000' : 'https://delicute.onrender.com';

        // Utility Functions
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.style.display = 'flex';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        function toggleDropdown() {
            document.getElementById('profileDropdown').classList.toggle('active');
        }

        function showSection(section) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById(`${section}Section`).classList.remove('hidden');
            toggleDropdown();
            const actions = {
                menu: fetchMenuItems,
                orders: fetchOrders,
                offers: fetchOffers,
                coupons: fetchCoupons,
                customers: fetchCustomers,
                contact: fetchContactMessages,
                profile: fetchAdminDetails
            };
            actions[section]?.();
        }

        function showModal(modalId) {
            closeModalAll();
            document.getElementById(modalId).style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function closeModalAll() {
            document.querySelectorAll('.modal').forEach(modal => modal.style.display = 'none');
        }

        async function uploadImage(file) {
            if (!file) return null;
            const formData = new FormData();
            formData.append('file', file);
            try {
                const response = await fetch(`${BASE_URL}/api/files/upload`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('adminToken')}` },
                    body: formData
                });
                const data = await response.json();
                if (response.ok) return data.fileUrl;
                showToast(data.error || 'Failed to upload image.', 'error');
                return null;
            } catch (error) {
                console.error('Error uploading image:', error);
                showToast('Failed to upload image.', 'error');
                return null;
            }
        }

        // Authentication and Profile
        async function fetchAdminDetails() {
            try {
                const response = await fetch(`${BASE_URL}/api/auth/admin/me`, {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('adminToken')}` }
                });
                const data = await response.json();
                if (response.ok) {
                    document.getElementById('welcomeMessage').textContent = `Welcome, ${data.name || 'Admin'}`;
                    document.getElementById('profileName').value = data.name || '';
                    document.getElementById('profileEmail').value = data.email || '';
                    document.getElementById('profilePhone').value = data.phone || '';
                    document.getElementById('displayProfileName').textContent = data.name || '';
                    document.getElementById('displayProfileEmail').textContent = data.email || '';
                    document.getElementById('displayProfilePhone').textContent = data.phone || '';
                    if (data.profileImage) {
                        document.getElementById('profileImage').src = data.profileImage;
                        document.getElementById('modalProfileImage').src = data.profileImage;
                        document.getElementById('displayProfileImage').src = data.profileImage;
                    }
                } else {
                    showToast(data.error || 'Failed to fetch admin details.', 'error');
                }
            } catch (error) {
                console.error('Error fetching admin details:', error);
                showToast('Failed to fetch admin details.', 'error');
            }
        }

        async function updateProfileImage() {
            const file = document.getElementById('profileImageUpload').files[0];
            if (!file) {
                showToast('Please select an image.', 'error');
                return;
            }
            const imageUrl = await uploadImage(file);
            if (!imageUrl) return;
            try {
                const response = await fetch(`${BASE_URL}/api/auth/admin/profile`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    },
                    body: JSON.stringify({ profileImage: imageUrl })
                });
                const data = await response.json();
                if (response.ok) {
                    showToast('Profile image updated successfully!', 'success');
                    fetchAdminDetails();
                    closeModal('profileModal');
                } else {
                    showToast(data.error || 'Failed to update profile image.', 'error');
                }
            } catch (error) {
                console.error('Error updating profile image:', error);
                showToast('Failed to update profile image.', 'error');
            }
        }

        async function checkAuth() {
            const token = localStorage.getItem('adminToken');
            if (!token) {
                window.location.href = 'admin.html';
                return;
            }
            try {
                const response = await fetch(`${BASE_URL}/api/auth/admin/me`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (!response.ok) {
                    localStorage.removeItem('adminToken');
                    window.location.href = 'admin.html';
                } else {
                    fetchAdminDetails();
                    showSection('home');
                    fetchOrders();
                    fetchMenuItems();
                }
            } catch (error) {
                console.error('Error checking auth:', error);
                localStorage.removeItem('adminToken');
                window.location.href = 'admin.html';
            }
        }

        // Menu Management
        async function fetchMenuItems() {
            try {
                const response = await fetch(`${BASE_URL}/api/menu`, {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('adminToken')}` }
                });
                const items = await response.json();
                displayMenuItems(items);
                document.getElementById('totalMenuItems').textContent = items.length;
            } catch (error) {
                console.error('Error fetching menu items:', error);
                showToast('Failed to load menu items.', 'error');
            }
        }

        function displayMenuItems(items) {
            const menuTableBody = document.getElementById('menuTableBody');
            menuTableBody.innerHTML = items.map(item => `
                <tr class="border-b">
                    <td class="py-2 px-2">
                        ${item.image ? `<img src="${item.image}" alt="${item.name}" class="menu-img">` : 'No Image'}
                    </td>
                    <td class="py-2 px-2">${item.name || 'N/A'}</td>
                    <td class="py-2 px-2">${item.category || 'N/A'}</td>
                    <td class="py-2 px-2 text-right">${item.price ? `₹${item.price.toFixed(2)}` : 'N/A'}</td>
                    <td class="py-2 px-2">${truncateText(item.description || 'N/A', 20)}</td>
                    <td class="py-2 px-2 flex space-x-1">
                        <button onclick="editMenuItem('${item._id}')" class="auth-btn bg-blue-500 hover:bg-blue-600 text-xs px-2 py-1">Edit</button>
                        <button onclick="deleteMenuItem('${item._id}')" class="auth-btn bg-red-500 hover:bg-red-600 text-xs px-2 py-1">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        async function addMenuItem() {
            const item = {
                name: document.getElementById('itemName').value.trim(),
                price: parseFloat(document.getElementById('itemPrice').value) || null,
                category: document.getElementById('itemCategory').value.trim(),
                imageUrl: document.getElementById('itemImage').value.trim(),
                file: document.getElementById('itemImageUpload').files[0],
                description: document.getElementById('itemDescription').value.trim()
            };

            if (!item.name || !item.category || !item.price) {
                showToast('Item name, category, and price are required.', 'error');
                return;
            }

            const uploadedImageUrl = item.file ? await uploadImage(item.file) : item.imageUrl || null;

            try {
                const response = await fetch(`${BASE_URL}/api/menu`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    },
                    body: JSON.stringify({
                        name: item.name,
                        price: item.price,
                        category: item.category,
                        image: uploadedImageUrl,
                        description: item.description
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    showToast('Menu item added successfully!', 'success');
                    ['itemName', 'itemPrice', 'itemCategory', 'itemImage', 'itemImageUpload', 'itemDescription'].forEach(id => {
                        document.getElementById(id).value = '';
                    });
                    fetchMenuItems();
                } else {
                    showToast(data.error || 'Failed to add menu item.', 'error');
                }
            } catch (error) {
                console.error('Error adding menu item:', error);
                showToast('Failed to add menu item.', 'error');
            }
        }

        async function editMenuItem(itemId) {
            try {
                const response = await fetch(`${BASE_URL}/api/menu/${itemId}`, {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('adminToken')}` }
                });
                const item = await response.json();
                if (response.ok) {
                    document.getElementById('editItemId').value = item._id;
                    document.getElementById('editItemName').value = item.name || '';
                    document.getElementById('editItemPrice').value = item.price || '';
                    document.getElementById('editItemCategory').value = item.category || '';
                    document.getElementById('editItemImage').value = item.image || '';
                    document.getElementById('editItemDescription').value = item.description || '';
                    showModal('editMenuModal');
                } else {
                    showToast(item.error || 'Failed to load menu item.', 'error');
                }
            } catch (error) {
                console.error('Error fetching menu item:', error);
                showToast('Failed to load menu item.', 'error');
            }
        }

        async function updateMenuItem() {
            const item = {
                id: document.getElementById('editItemId').value,
                name: document.getElementById('editItemName').value.trim(),
                price: parseFloat(document.getElementById('editItemPrice').value) || null,
                category: document.getElementById('editItemCategory').value.trim(),
                imageUrl: document.getElementById('editItemImage').value.trim(),
                file: document.getElementById('editItemImageUpload').files[0],
                description: document.getElementById('editItemDescription').value.trim()
            };

            if (!item.name || !item.category || !item.price) {
                showToast('Item name, category, and price are required.', 'error');
                return;
            }

            const uploadedImageUrl = item.file ? await uploadImage(item.file) : item.imageUrl || null;

            try {
                const response = await fetch(`${BASE_URL}/api/menu/${item.id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    },
                    body: JSON.stringify({
                        name: item.name,
                        price: item.price,
                        category: item.category,
                        image: uploadedImageUrl,
                        description: item.description
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    showToast('Menu item updated successfully!', 'success');
                    closeModal('editMenuModal');
                    fetchMenuItems();
                } else {
                    showToast(data.error || 'Failed to update menu item.', 'error');
                }
            } catch (error) {
                console.error('Error updating menu item:', error);
                showToast('Failed to update menu item.', 'error');
            }
        }

        async function deleteMenuItem(itemId) {
            if (!confirm('Are you sure you want to delete this menu item?')) return;
            try {
                const response = await fetch(`${BASE_URL}/api/menu/${itemId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('adminToken')}` }
                });
                const data = await response.json();
                if (response.ok) {
                    showToast('Menu item deleted successfully!', 'success');
                    fetchMenuItems();
                } else {
                    showToast(data.error || 'Failed to delete menu item.', 'error');
                }
            } catch (error) {
                console.error('Error deleting menu item:', error);
                showToast('Failed to delete menu item.', 'error');
            }
        }

        // Order Management
        async function fetchOrders() {
            try {
                const response = await fetch(`${BASE_URL}/api/orders`, {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('adminToken')}` }
                });
                const orders = await response.json();
                displayOrders(orders);
                document.getElementById('totalOrders').textContent = orders.length;
                document.getElementById('pendingOrders').textContent = orders.filter(order => order.status === 'pending').length;
            } catch (error) {
                console.error('Error fetching orders:', error);
                showToast('Failed to load orders.', 'error');
            }
        }

        function displayOrders(orders) {
            document.getElementById('orderTableBody').innerHTML = orders.map(order => `
                <tr class="border-b">
                    <td class="py-2 px-2">${truncateText(order._id || '10', 'N/A')}</td>
                    <td class="py-2 px-2">${order.customerName || 'N/A'}</td>
                    <td class="py-2 px-2 text-right">₹${order.total.toFixed(2)}</td>
                    <td class="py-2 px-2 text-center">${order.status}</td>
                    <td class="py-2 px-2 px-2 text-center">${order.paymentStatus || 'Pending'}</td>
                    <td class="py-2 px-2 flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-1">
                        <select onchange="updateOrderStatus('${order._id}', 'this.value)" class="input-field p-2 border rounded-md text-xs sm:text-sm">
                            <option value="Pending" ${order.status === 'Pending' ? 'selected' : ''}>Pending</option>
                            <option value="Confirmed" ${order.status === 'Confirmed' ? 'selected' : ''}>Confirmed</option>
                            <option value="Delivered" ${order.status === 'Delivered' ? 'selected' : ''}>Delivered</option>
                            <option value="Cancelled" ${order.status === 'Cancelled' ? 'selected' : ''}>Cancelled</option>
                        </select>
                        ${order.paymentStatus === 'Paid' ? `<button onclick="refundOrder('${order._id}')" class="auth-btn bg-red-600 hover:bg-red-600 text-xs px-2 py-1">Refund</button>` : ''}>
                    </td>
                </tr>
            `).join('');
        }

        async function updateOrderStatus(orderId, status) {
            try {
                const response = await fetch(`${BASE_URL}/api/orders/${orderId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    },
                    body: JSON.stringify({ status: status })
                });
                const data = await response.json();
                if (response.ok) {
                    showToast(`Order status updated to ${status}!`, 'success');
                    fetchOrders();
                } else {
                    showToast(data.error || 'Failed to update order status.', 'error');
                }
            } catch (error) {
                console.error('Error updating order status:', error);
                showToast('Failed to update order status.', 'error');
            }
        }

        async function refundOrder(orderId) {
            if (!confirm('Are you sure you want to refund this order?')) return;
            try {
                const response = await fetch(`${BASE_URL}/api/orders/${orderId}/refund`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('adminToken')}` }
                });
                const data = await response.json();
                if (response.ok) {
                    showToast('Order refunded successfully!', 'success');
                    fetchOrders();
                } else {
                    showToast(data.error || 'Failed to process refund.', 'error');
                }
            } catch (error) {
                console.error('Error processing refund:', error);
                showToast('Failed to process refund.', 'error');
            }
        }

        // Special Offers
        async function fetchOffers() {
            try {
                const response = await fetch(`${BASE_URL}/api/offers`, {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('adminToken')}` }
                });
                const offers = await response.json();
                displayOffers(offers);
            } catch (error) {
                console.error('Error fetching offers:', error);
                showToast('Failed to load offers.', 'error');
            }
        }

        function displayOffers(offers) {
            document.getElementById('offerTableBody').innerHTML = offers.map(offer => `
                <tr class="border-b">
                    <td class="py-2 px-2">
                        ${offer.image ? `<img src="${offer.image}" alt="${offer.name}" class="menu-img">` : 'No Image'}
                    </td>
                    <td class="py-2 px-2">${offer.name || 'N/A'}</td>
                    <td class="py-2 px-2 text-right">₹${offer.price.toFixed(2)}</td>
                    <td class="py-2 px-2 flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-1">
                        <button onclick="editOffer('${offer._id}')" class="auth-btn bg-blue-500 hover:bg-blue-600 text-xs px-2 py-1">Edit</button>
                        <button onclick="deleteOffer('${offer._id}')" class="auth-btn bg-red-500 hover:bg-red-600 text-xs px-2 py-1">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        async function addOffer() {
            const offer = {
                name: document.getElementById('offerName').value.trim(),
                price: parseFloat(document.getElementById('offerPrice').value) || null,
                imageUrl: document.getElementById('offerImage').value.trim(),
                file: document.getElementById('offerImageUpload').files[0],
                description: document.getElementById('offerDescription').value.trim()
            };

            if (!offer.name || !offer.price) {
                showToast('Offer name and price are required.', 'error');
                return;
            }

            const uploadedImageUrl = offer.file ? await uploadImage(offer.file) : offer.imageUrl || null;

            try {
                const response = await fetch(`${BASE_URL}/api/offers`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    },
                    body: JSON.stringify({
                        name: offer.name,
                        price: offer.price,
                        image: uploadedImageUrl,
                        description: offer.description
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    showToast('Offer added successfully!', 'success');
                    ['offerName', 'offerPrice', 'offerImage', 'offerImageUpload', 'offerDescription'].forEach(id => {
                        document.getElementById(id).value = '';
                    });
                    fetchOffers();
                } else {
                    showToast(data.error || 'Failed to add offer.', 'error');
                }
            } catch (error) {
                console.error('Error adding offer:', error);
                showToast('Failed to add offer.', 'error');
            }
        }

        async function editOffer(id) {
            try {
                const response = await fetch(`${BASE_URL}/api/offers/${id}`, {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('adminToken')}` }
                });
                const offer = await response.json();
                if (response.ok) {
                    document.getElementById('editOfferId').value = offer._id;
                    document.getElementById('editOfferName').value = offer.name || '';
                    document.getElementById('editOfferPrice').value = offer.price || '';
                    document.getElementById('editOfferImage').value = offer.image || '';
                    document.getElementById('editOfferDescription').value = offer.description || '';
                    showModal('editOfferModal');
                } else {
                    showToast(offer.error || 'Failed to load offer.', 'error');
                }
            } catch (error) {
                console.error('Error fetching offer:', error);
                showToast('Failed to load offer.', 'error');
            }
        }

        async function updateOffer() {
            const offer = {
                id: document.getElementById('editOfferId').value,
                name: document.getElementById('editOfferName').value.trim(),
                price: parseFloat(document.getElementById('editOfferPrice').value) || null,
                imageUrl: document.getElementById('editOfferImage').value.trim(),
                file: document.getElementById('editOfferImageUpload').files[0],
                description: document.getElementById('editOfferDescription').value.trim()
            };

            if (!offer.name || !offer.price) {
                showToast('Offer name and price are required.', 'error');
                return;
            }

            const uploadedImageUrl = offer.file ? await uploadImage(offer.file) : offer.imageUrl || null;

            try {
                const response = await fetch(`${BASE_URL}/api/offers/${offer.id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    },
                    body: JSON.stringify({
                        name: offer.name,
                        price: offer.price,
                        image: uploadedImageUrl,
                        description: offer.description
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    showToast('Offer updated successfully!', 'success');
                    closeModal('editOfferModal');
                    fetchOffers();
                } else {
                    showToast(data.error || 'Failed to update offer.', 'error');
                }
            } catch (error) {
                console.error('Error updating offer:', error);
                showToast('Failed to update offer.', 'error');
            }
        }

        async function deleteOffer(id) {
            if (!confirm('Are you sure you want to delete this offer?')) return;
            try {
                const response = await fetch(`${BASE_URL}/api/offers/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('adminToken')}` }
                });
                const data = await response.json();
                if (response.ok) {
                    showToast('Offer deleted successfully!', 'success');
                    fetchOffers();
                } else {
                    showToast(data.error || 'Failed to delete offer.', 'error');
                }
            } catch (error) {
                console.error('Error deleting offer:', error);
                showToast('Failed to delete offer.', 'error');
            }
        }

        // Coupon Management
        async function fetchCoupons() {
            try {
                const response = await fetch(`${BASE_URL}/api/coupons`, {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('adminToken')}` }
                });
                const coupons = await response.json();
                displayCoupons(coupons);
            } catch (error) {
                console.error('Error fetching coupons:', error);
                showToast('Failed to load coupons.', 'error');
            }
        }

        function displayCoupons(coupons) {
            document.getElementById('couponTableBody').innerHTML = coupons.map(coupon => `
                <tr class="border-b">
                    <td class="py-2 px-2">
                        ${coupon.image ? `<img src="${coupon.image}" alt="${coupon.code || 'Coupon'}" class="menu-img">` : 'No Image'}
                    </td>
                    <td class="py-2 px-2">${coupon.code || 'N/A'}</td>
                    <td class="py-2 px-2 text-right">${coupon.discount ? `${coupon.discount}%` : 'N/A'}</td>
                    <td class="py-2 px-2 flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-1">
                        <button onclick="editCoupon('${coupon._id}')" class="auth-btn bg-blue-500 hover:bg-blue-600 text-xs px-2 py-1">Edit</button>
                        <button onclick="deleteCoupon('${coupon._id}')" class="auth-btn bg-red-500 hover:bg-red-600 text-xs px-2 py-1">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        async function addCoupon() {
            const coupon = {
                code: document.getElementById('couponCode').value.trim(),
                discount: parseInt(document.getElementById('couponDiscount').value) || null,
                imageUrl: document.getElementById('couponImage').value.trim(),
                file: document.getElementById('couponImageUpload').files[0],
                description: document.getElementById('couponDescription').value.trim()
            };

            if (!coupon.code || !coupon.discount) {
                showToast('Coupon code and discount are required.', 'error');
                return;
            }

            if (coupon.discount < 1 || coupon.discount > 100) {
                showToast('Discount must be between 1% and 100%.', 'error');
                return;
            }

            const uploadedImageUrl = coupon.file ? await uploadImage(coupon.file) : coupon.imageUrl || null;

            try {
                const response = await fetch(`${BASE_URL}/api/coupons`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    },
                    body: JSON.stringify({
                        code: coupon.code,
                        discount: coupon.discount,
                        image: uploadedImageUrl,
                        description: coupon.description
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    showToast('Coupon added successfully!', 'success');
                    ['couponCode', 'couponDiscount', 'couponImage', 'couponImageUpload', 'couponDescription'].forEach(id => {
                        document.getElementById(id).value = '';
                    });
                    fetchCoupons();
                } else {
                    showToast(data.error || 'Failed to add coupon.', 'error');
                }
            } catch (error) {
                console.error('Error adding coupon:', error);
                showToast('Failed to add coupon.', 'error');
            }
        }

        async function editCoupon(id) {
            try {
                const response = await fetch(`${BASE_URL}/api/coupons/${id}`, {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('adminToken')}` }
                });
                const coupon = await response.json();
                if (response.ok) {
                    document.getElementById('editCouponId').value = coupon._id;
                    document.getElementById('editCouponCode').value = coupon.code || '';
                    document.getElementById('editCouponDiscount').value = coupon.discount || '';
                    document.getElementById('editCouponImage').value = coupon.image || '';
                    document.getElementById('editCouponDescription').value = coupon.description || '';
                    showModal('editCouponModal');
                } else {
                    showToast(coupon.error || 'Failed to load coupon.', 'error');
                }
            } catch (error) {
                console.error('Error fetching coupon:', error);
                showToast('Failed to load coupon.', 'error');
            }
        }

                async function updateCoupon() {
            const coupon = {
                id: document.getElementById('editCouponId').value,
                code: document.getElementById('editCouponCode').value.trim(),
                discount: parseInt(document.getElementById('editCouponDiscount').value) || null,
                imageUrl: document.getElementById('editCouponImage').value.trim(),
                file: document.getElementById('editCouponImageUpload').files[0],
                description: document.getElementById('editCouponDescription').value.trim()
            };

            if (!coupon.code || !coupon.discount) {
                showToast('Coupon code and discount are required.', 'error');
                return;
            }

            if (coupon.discount < 1 || coupon.discount > 100) {
                showToast('Discount must be between 1% and 100%.', 'error');
                return;
            }

            const uploadedImageUrl = coupon.file ? await uploadImage(coupon.file) : coupon.imageUrl || null;

            try {
                const response = await fetch(`${BASE_URL}/api/coupons/${coupon.id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    },
                    body: JSON.stringify({
                        code: coupon.code,
                        discount: coupon.discount,
                        image: uploadedImageUrl,
                        description: coupon.description
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    showToast('Coupon updated successfully!', 'success');
                    closeModal('editCouponModal');
                    fetchCoupons();
                } else {
                    showToast(data.error || 'Failed to update coupon.', 'error');
                }
            } catch (error) {
                console.error('Error updating coupon:', error);
                showToast('Failed to update coupon.', 'error');
            }
        }

        async function deleteCoupon(id) {
            if (!confirm('Are you sure you want to delete this coupon?')) return;
            try {
                const response = await fetch(`${BASE_URL}/api/coupons/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('adminToken')}` }
                });
                const data = await response.json();
                if (response.ok) {
                    showToast('Coupon deleted successfully!', 'success');
                    fetchCoupons();
                } else {
                    showToast(data.error || 'Failed to delete coupon.', 'error');
                }
            } catch (error) {
                console.error('Error deleting coupon:', error);
                showToast('Failed to delete coupon.', 'error');
            }
        }

        // Customer Management
        async function fetchCustomers() {
            try {
                const response = await fetch(`${BASE_URL}/api/users`, {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('adminToken')}` }
                });
                const customers = await response.json();
                displayCustomers(customers);
            } catch (error) {
                console.error('Error fetching customers:', error);
                showToast('Failed to load customers.', 'error');
            }
        }

        function displayCustomers(customers) {
            document.getElementById('customerTableBody').innerHTML = customers.map(customer => `
                <tr class="border-b">
                    <td class="py-2 px-2">${customer.name || 'N/A'}</td>
                    <td class="py-2 px-2">${customer.email || 'N/A'}</td>
                    <td class="py-2 px-2">${customer.phone || 'N/A'}</td>
                    <td class="py-2 px-2">${customer.status || 'Active'}</td>
                    <td class="py-2 px-2">
                        <button onclick="viewCustomerDetails('${customer._id}')" class="auth-btn bg-blue-500 hover:bg-blue-600 text-xs px-2 py-1">View</button>
                    </td>
                </tr>
            `).join('');
        }

        async function viewCustomerDetails(customerId) {
            try {
                const response = await fetch(`${BASE_URL}/api/users/${customerId}`, {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('adminToken')}` }
                });
                const customer = await response.json();
                if (response.ok) {
                    document.getElementById('customerName').textContent = customer.name || 'N/A';
                    document.getElementById('customerEmail').textContent = customer.email || 'N/A';
                    document.getElementById('customerPhone').textContent = customer.phone || 'N/A';
                    document.getElementById('customerStatus').textContent = customer.status || 'Active';
                    const blockUnblockBtn = document.getElementById('blockUnblockBtn');
                    blockUnblockBtn.textContent = customer.status === 'Blocked' ? 'Unblock' : 'Block';
                    blockUnblockBtn.onclick = () => toggleCustomerStatus(customer._id, customer.status);
                    const orderHistory = customer.orders || [];
                    document.getElementById('customerOrderHistory').innerHTML = `
                        <table class="w-full text-sm">
                            <thead>
                                <tr>
                                    <th class="py-1 px-2">Order ID</th>
                                    <th class="py-1 px-2">Total</th>
                                    <th class="py-1 px-2">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${orderHistory.map(order => `
                                    <tr class="border-b">
                                        <td class="py-1 px-2">${truncateText(order._id, 10)}</td>
                                        <td class="py-1 px-2 text-right">₹${order.total.toFixed(2)}</td>
                                        <td class="py-1 px-2">${order.status}</td>
                                    </tr>
                                `).join('') || '<tr><td colspan="3" class="py-1 px-2 text-center">No orders found</td></tr>'}
                            </tbody>
                        </table>
                    `;
                    showModal('customerDetailsModal');
                } else {
                    showToast(customer.error || 'Failed to load customer details.', 'error');
                }
            } catch (error) {
                console.error('Error fetching customer details:', error);
                showToast('Failed to load customer details.', 'error');
            }
        }

        async function toggleCustomerStatus(customerId, currentStatus) {
            const newStatus = currentStatus === 'Blocked' ? 'Active' : 'Blocked';
            try {
                const response = await fetch(`${BASE_URL}/api/users/${customerId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    },
                    body: JSON.stringify({ status: newStatus })
                });
                const data = await response.json();
                if (response.ok) {
                    showToast(`Customer ${newStatus.toLowerCase()} successfully!`, 'success');
                    closeModal('customerDetailsModal');
                    fetchCustomers();
                } else {
                    showToast(data.error || `Failed to ${newStatus.toLowerCase()} customer.`, 'error');
                }
            } catch (error) {
                console.error(`Error toggling customer status:`, error);
                showToast(`Failed to ${newStatus.toLowerCase()} customer.`, 'error');
            }
        }

        // Contact Messages
        async function fetchContactMessages() {
            try {
                const response = await fetch(`${BASE_URL}/api/contact`, {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('adminToken')}` }
                });
                const messages = await response.json();
                displayContactMessages(messages);
            } catch (error) {
                console.error('Error fetching contact messages:', error);
                showToast('Failed to load contact messages.', 'error');
            }
        }

        function displayContactMessages(messages) {
            document.getElementById('contactTableBody').innerHTML = messages.map(message => `
                <tr class="border-b">
                    <td class="py-2 px-2">${message.name || 'N/A'}</td>
                    <td class="py-2 px-2">${message.email || 'N/A'}</td>
                    <td class="py-2 px-2">${message.subject || 'N/A'}</td>
                    <td class="py-2 px-2">${truncateText(message.message || 'N/A', 20)}</td>
                    <td class="py-2 px-2">${message.status || 'Pending'}</td>
                    <td class="py-2 px-2 flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-1">
                        <button onclick="replyToMessage('${message._id}')" class="auth-btn bg-blue-500 hover:bg-blue-600 text-xs px-2 py-1">Reply</button>
                        <button onclick="deleteContactMessage('${message._id}')" class="auth-btn bg-red-500 hover:bg-red-600 text-xs px-2 py-1">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function replyToMessage(messageId) {
            document.getElementById('contactMessageId').value = messageId;
            document.getElementById('contactReplySubject').value = '';
            document.getElementById('contactReplyMessage').value = '';
            showModal('replyContactModal');
        }

        async function sendReply() {
            const messageId = document.getElementById('contactMessageId').value;
            const subject = document.getElementById('contactReplySubject').value.trim();
            const message = document.getElementById('contactReplyMessage').value.trim();

            if (!subject || !message) {
                showToast('Subject and message are required.', 'error');
                return;
            }

            try {
                const response = await fetch(`${BASE_URL}/api/contact/${messageId}/reply`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    },
                    body: JSON.stringify({ subject, message })
                });
                const data = await response.json();
                if (response.ok) {
                    showToast('Reply sent successfully!', 'success');
                    closeModal('replyContactModal');
                    fetchContactMessages();
                } else {
                    showToast(data.error || 'Failed to send reply.', 'error');
                }
            } catch (error) {
                console.error('Error sending reply:', error);
                showToast('Failed to send reply.', 'error');
            }
        }

        async function deleteContactMessage(messageId) {
            if (!confirm('Are you sure you want to delete this message?')) return;
            try {
                const response = await fetch(`${BASE_URL}/api/contact/${messageId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('adminToken')}` }
                });
                const data = await response.json();
                if (response.ok) {
                    showToast('Message deleted successfully!', 'success');
                    fetchContactMessages();
                } else {
                    showToast(data.error || 'Failed to delete message.', 'error');
                }
            } catch (error) {
                console.error('Error deleting message:', error);
                showToast('Failed to delete message.', 'error');
            }
        }

        // Restaurant Status
        async function toggleRestaurantStatus() {
            const currentStatus = document.getElementById('restaurantStatus').textContent;
            const newStatus = currentStatus === 'Open' ? 'Closed' : 'Open';
            try {
                const response = await fetch(`${BASE_URL}/api/restaurant/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    },
                    body: JSON.stringify({ status: newStatus })
                });
                const data = await response.json();
                if (response.ok) {
                    document.getElementById('restaurantStatus').textContent = newStatus;
                    document.getElementById('statusToggleBtn').textContent = newStatus === 'Open' ? 'Close Restaurant' : 'Open Restaurant';
                    showToast(`Restaurant is now ${newStatus}!`, 'success');
                } else {
                    showToast(data.error || 'Failed to update restaurant status.', 'error');
                }
            } catch (error) {
                console.error('Error toggling restaurant status:', error);
                showToast('Failed to update restaurant status.', 'error');
            }
        }

        // Logout
        function logout() {
            localStorage.removeItem('adminToken');
            window.location.href = 'admin.html';
        }

        // Helper Functions
        function truncateText(text, length) {
            if (text.length <= length) return text;
            return text.substring(0, length) + '...';
        }

        // Mobile Menu Toggle
        document.getElementById('menuToggle').addEventListener('click', () => {
            const navbarMenu = document.getElementById('navbarMenu');
            navbarMenu.classList.toggle('active');
        });

        // Initialize
        checkAuth();
    </script>
</body>
</html>
<xaiArtifact/>