<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delicute - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            color: #1f2937;
            margin: 0;
        }
        .auth-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 2.5rem;
            max-width: 1400px;
            width: 95%;
            margin: 2rem auto;
            transition: transform 0.3s ease;
        }
        .auth-container:hover {
            transform: translateY(-5px);
        }
        .input-field {
            transition: all 0.3s ease;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 0.75rem;
        }
        .input-field:focus {
            border-color: #f59e0b;
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2);
            outline: none;
        }
        .auth-btn {
            background: linear-gradient(90deg, #f59e0b, #f97316);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
        }
        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(245, 158, 11, 0.3);
            background: linear-gradient(90deg, #f97316, #f59e0b);
        }
        .auth-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.4s ease, height 0.4s ease;
        }
        .auth-btn:hover::after {
            width: 300px;
            height: 300px;
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: white;
            z-index: 1000;
            display: none;
            min-width: 250px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            animation: slideIn 0.3s ease;
        }
        .toast.success {
            background: linear-gradient(90deg, #22c55e, #16a34a);
        }
        .toast.error {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .table-container {
            max-height: 500px;
            overflow-y: auto;
            border-radius: 8px;
            background: white;
        }
        .table-container table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        .table-container th, .table-container td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        .table-container th {
            background: #f9fafb;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .profile-container {
            position: relative;
        }
        .profile-img {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
            cursor: pointer;
            border: 3px solid #f59e0b;
            transition: transform 0.3s ease;
        }
        .profile-img:hover {
            transform: scale(1.1);
        }
        .dropdown-menu {
            display: none;
            position: absolute;
            top: 60px;
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            min-width: 200px;
            z-index: 100;
            overflow: hidden;
        }
        .dropdown-menu.active {
            display: block;
            animation: dropdown 0.3s ease;
        }
        @keyframes dropdown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .dropdown-item {
            padding: 0.75rem 1rem;
            color: #1f2937;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .dropdown-item:hover {
            background: #f59e0b;
            color: white;
        }
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }
        .home-bg {
            background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
            border-radius: 16px;
            padding: 3rem;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        .home-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://images.unsplash.com/photo-1504674900247-0877df9cc836?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80') no-repeat center center;
            background-size: cover;
            opacity: 0.2;
            z-index: 0;
        }
        .home-bg > * {
            position: relative;
            z-index: 1;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: modalPop 0.3s ease;
        }
        @keyframes modalPop {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .close-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            font-size: 1.5rem;
            cursor: pointer;
            color: #374151;
            transition: color 0.2s ease;
        }
        .close-btn:hover {
            color: #f59e0b;
        }
        .menu-img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #f59e0b;
        }
    </style>
</head>
<body>
    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('profileModal')">×</span>
            <h2 class="text-2xl font-bold text-gray-800 text-center mb-6">Admin Profile</h2>
            <div class="flex justify-center mb-6">
                <img id="modalProfileImage" src="https://via.placeholder.com/100" alt="Profile" class="w-28 h-28 rounded-full border-4 border-yellow-500 object-cover">
            </div>
            <div>
                <label for="profileName" class="block text-gray-700 font-medium mb-2">Name</label>
                <input type="text" id="profileName" class="input-field w-full" readonly>
            </div>
            <div class="mt-4">
                <label for="profileEmail" class="block text-gray-700 font-medium mb-2">Email</label>
                <input type="email" id="profileEmail" class="input-field w-full" readonly>
            </div>
            <div class="mt-4">
                <label for="profilePhone" class="block text-gray-700 font-medium mb-2">Phone Number</label>
                <input type="tel" id="profilePhone" class="input-field w-full" readonly>
            </div>
            <div class="mt-4">
                <label for="profileImageUpload" class="block text-gray-700 font-medium mb-2">Upload Profile Image</label>
                <input type="file" id="profileImageUpload" class="input-field w-full" accept="image/*">
            </div>
            <div class="mt-6">
                <button onclick="updateProfileImage()" class="auth-btn text-white w-full">Update Profile Image</button>
            </div>
        </div>
    </div>

    <!-- Edit Menu Item Modal -->
    <div id="editMenuModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('editMenuModal')">×</span>
            <h2 class="text-2xl font-bold text-gray-800 text-center mb-6">Edit Menu Item</h2>
            <input type="hidden" id="editItemId">
            <div>
                <label for="editItemName" class="block text-gray-700 font-medium mb-2">Item Name</label>
                <input type="text" id="editItemName" class="input-field w-full" placeholder="Item Name">
            </div>
            <div class="mt-4">
                <label for="editItemPrice" class="block text-gray-700 font-medium mb-2">Price (₹)</label>
                <input type="number" id="editItemPrice" class="input-field w-full" placeholder="Price">
            </div>
            <div class="mt-4">
                <label for="editItemCategory" class="block text-gray-700 font-medium mb-2">Category</label>
                <select id="editItemCategory" class="input-field w-full">
                    <option value="">Select Category</option>
                    <option value="Veg Pizza">Veg Pizza</option>
                    <option value="Non-Veg Pizza">Non-Veg Pizza</option>
                    <option value="Mocktails">Mocktails</option>
                    <option value="Juice">Juice</option>
                    <option value="Maggie">Maggie</option>
                    <option value="Pasta">Pasta</option>
                    <option value="Shakes">Shakes</option>
                    <option value="Waffles">Waffles</option>
                    <option value="French Fries">French Fries</option>
                    <option value="Desserts">Desserts</option>
                </select>
            </div>
            <div class="mt-4">
                <label for="editItemImage" class="block text-gray-700 font-medium mb-2">Image URL (Optional)</label>
                <input type="text" id="editItemImage" class="input-field w-full" placeholder="Image URL">
            </div>
            <div class="mt-4">
                <label for="editItemImageUpload" class="block text-gray-700 font-medium mb-2">Upload Image (Optional)</label>
                <input type="file" id="editItemImageUpload" class="input-field w-full" accept="image/*">
            </div>
            <div class="mt-4">
                <label for="editItemDescription" class="block text-gray-700 font-medium mb-2">Description</label>
                <textarea id="editItemDescription" class="input-field w-full" rows="4" placeholder="Item Description"></textarea>
            </div>
            <div class="mt-6">
                <button onclick="updateMenuItem()" class="auth-btn text-white w-full">Update Item</button>
            </div>
        </div>
    </div>

    <!-- Edit Offer Modal -->
    <div id="editOfferModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('editOfferModal')">×</span>
            <h2 class="text-2xl font-bold text-gray-800 text-center mb-6">Edit Special Offer</h2>
            <input type="hidden" id="editOfferId">
            <div>
                <label for="editOfferName" class="block text-gray-700 font-medium mb-2">Offer Name</label>
                <input type="text" id="editOfferName" class="input-field w-full" placeholder="Offer Name">
            </div>
            <div class="mt-4">
                <label for="editOfferPrice" class="block text-gray-700 font-medium mb-2">Price (₹)</label>
                <input type="number" id="editOfferPrice" class="input-field w-full" placeholder="Price">
            </div>
            <div class="mt-4">
                <label for="editOfferImage" class="block text-gray-700 font-medium mb-2">Image URL (Optional)</label>
                <input type="text" id="editOfferImage" class="input-field w-full" placeholder="Image URL">
            </div>
            <div class="mt-4">
                <label for="editOfferImageUpload" class="block text-gray-700 font-medium mb-2">Upload Image (Optional)</label>
                <input type="file" id="editOfferImageUpload" class="input-field w-full" accept="image/*">
            </div>
            <div class="mt-4">
                <label for="editOfferDescription" class="block text-gray-700 font-medium mb-2">Description</label>
                <textarea id="editOfferDescription" class="input-field w-full" rows="4" placeholder="Offer Description"></textarea>
            </div>
            <div class="mt-6">
                <button onclick="updateOffer()" class="auth-btn text-white w-full">Update Offer</button>
            </div>
        </div>
    </div>

    <!-- Edit Coupon Modal -->
    <div id="editCouponModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('editCouponModal')">×</span>
            <h2 class="text-2xl font-bold text-gray-800 text-center mb-6">Edit Coupon</h2>
            <input type="hidden" id="editCouponId">
            <div>
                <label for="editCouponCode" class="block text-gray-700 font-medium mb-2">Coupon Code</label>
                <input type="text" id="editCouponCode" class="input-field w-full" placeholder="Coupon Code">
            </div>
            <div class="mt-4">
                <label for="editCouponDiscount" class="block text-gray-700 font-medium mb-2">Discount (%)</label>
                <input type="number" id="editCouponDiscount" class="input-field w-full" placeholder="Discount Percentage" min="1" max="100">
            </div>
            <div class="mt-4">
                <label for="editCouponImage" class="block text-gray-700 font-medium mb-2">Image URL (Optional)</label>
                <input type="text" id="editCouponImage" class="input-field w-full" placeholder="Image URL">
            </div>
            <div class="mt-4">
                <label for="editCouponImageUpload" class="block text-gray-700 font-medium mb-2">Upload Image (Optional)</label>
                <input type="file" id="editCouponImageUpload" class="input-field w-full" accept="image/*">
            </div>
            <div class="mt-4">
                <label for="editCouponDescription" class="block text-gray-700 font-medium mb-2">Description</label>
                <textarea id="editCouponDescription" class="input-field w-full" rows="4" placeholder="Coupon Description"></textarea>
            </div>
            <div class="mt-6">
                <button onclick="updateCoupon()" class="auth-btn text-white w-full">Update Coupon</button>
            </div>
        </div>
    </div>

    <!-- Customer Details Modal -->
    <div id="customerDetailsModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('customerDetailsModal')">×</span>
            <h2 class="text-2xl font-bold text-gray-800 text-center mb-6">Customer Details</h2>
            <div>
                <p><strong>Name:</strong> <span id="customerName"></span></p>
                <p><strong>Email:</strong> <span id="customerEmail"></span></p>
                <p><strong>Phone:</strong> <span id="customerPhone"></span></p>
                <p><strong>Status:</strong> <span id="customerStatus"></span></p>
            </div>
            <div class="mt-4">
                <h3 class="text-lg font-medium text-gray-700 mb-2">Order History</h3>
                <div id="customerOrderHistory" class="table-container"></div>
            </div>
            <div class="mt-6 flex space-x-4">
                <button id="blockUnblockBtn" class="auth-btn text-white px-4 py-2"></button>
                <button onclick="closeModal('customerDetailsModal')" class="auth-btn bg-gray-500 hover:bg-gray-600 text-white px-4 py-2">Close</button>
            </div>
        </div>
    </div>

    <!-- Navbar -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <img src="https://i.postimg.cc/zv19J0xv/Zbhz-Fq-T-Imgur.jpg" alt="Delicute Logo" class="h-12">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">DELICUTE</h1>
                        <p class="text-sm text-gray-500">Admin Panel</p>
                    </div>
                </div>
                <div class="flex items-center space-x-6">
                    <span id="welcomeMessage" class="text-gray-600 font-medium hidden sm:block"></span>
                    <div class="profile-container">
                        <img id="profileImage" src="https://via.placeholder.com/40" alt="Profile" class="profile-img" onclick="toggleDropdown()">
                        <div id="profileDropdown" class="dropdown-menu">
                            <div class="dropdown-item" onclick="showSection('home')">Home</div>
                            <div class="dropdown-item" onclick="showSection('profile')">Profile</div>
                            <div class="dropdown-item" onclick="showSection('menu')">Menu</div>
                            <div class="dropdown-item" onclick="showSection('orders')">Orders</div>
                            <div class="dropdown-item" onclick="showSection('offers')">Special Offers</div>
                            <div class="dropdown-item" onclick="showSection('coupons')">Coupons</div>
                            <div class="dropdown-item" onclick="showSection('customers')">Customers</div>
                            <div class="dropdown-item" onclick="logout()">Logout</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Dashboard -->
    <div class="auth-container">
        <!-- Home Section -->
        <section id="homeSection" class="home-bg mb-12">
            <h2 class="text-4xl font-bold text-center mb-10">Welcome to Delicute Admin Panel</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="stat-card">
                    <h3 class="text-lg font-semibold text-gray-700">Total Orders</h3>
                    <p id="totalOrders" class="text-3xl font-bold text-yellow-500 mt-3">0</p>
                </div>
                <div class="stat-card">
                    <h3 class="text-lg font-semibold text-gray-700">Menu Items</h3>
                    <p id="totalMenuItems" class="text-3xl font-bold text-yellow-500 mt-3">0</p>
                </div>
                <div class="stat-card">
                    <h3 class="text-lg font-semibold text-gray-700">Pending Orders</h3>
                    <p id="pendingOrders" class="text-3xl font-bold text-yellow-500 mt-3">0</p>
                </div>
                <div class="stat-card">
                    <h3 class="text-lg font-semibold text-gray-700">Restaurant Status</h3>
                    <p id="restaurantStatus" class="text-3xl font-bold text-yellow-500 mt-3">Closed</p>
                    <button onclick="toggleRestaurantStatus()" id="statusToggleBtn" class="auth-btn text-white px-4 py-2 mt-3">Open Restaurant</button>
                </div>
            </div>
        </section>

        <!-- Profile ..

Section -->
        <section id="profileSection" class="mb-12 hidden">
            <h3 class="text-3xl font-semibold text-gray-800 mb-6">Admin Profile</h3>
            <div class="bg-white p-8 rounded-lg shadow-md">
                <div class="flex justify-center mb-6">
                    <img id="displayProfileImage" src="https://via.placeholder.com/100" alt="Profile" class="w-28 h-28 rounded-full border-4 border-yellow-500 object-cover">
                </div>
                <p class="text-lg"><strong>Name:</strong> <span id="displayProfileName"></span></p>
                <p class="text-lg mt-2"><strong>Email:</strong> <span id="displayProfileEmail"></span></p>
                <p class="text-lg mt-2"><strong>Phone:</strong> <span id="displayProfilePhone"></span></p>
                <div class="mt-6">
                    <button onclick="showModal('profileModal')" class="auth-btn text-white px-6 py-3">Edit Profile Image</button>
                </div>
            </div>
        </section>

        <!-- Menu Management Section -->
        <section id="menuSection" class="mb-12 hidden">
            <h3 class="text-3xl font-semibold text-gray-800 mb-6">Manage Menu</h3>
            <!-- Add Menu Item Form -->
            <div class="bg-white p-8 rounded-lg shadow-md mb-8">
                <h4 class="text-xl font-medium text-gray-700 mb-6">Add New Menu Item</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="itemName" class="block text-gray-700 font-medium mb-2">Item Name</label>
                        <input type="text" id="itemName" class="input-field w-full" placeholder="Item Name">
                    </div>
                    <div>
                        <label for="itemPrice" class="block text-gray-700 font-medium mb-2">Price (₹)</label>
                        <input type="number" id="itemPrice" class="input-field w-full" placeholder="Price">
                    </div>
                    <div>
                        <label for="itemCategory" class="block text-gray-700 font-medium mb-2">Category</label>
                        <select id="itemCategory" class="input-field w-full">
                            <option value="">Select Category</option>
                            <option value="Veg Pizza">Veg Pizza</option>
                            <option value="Non-Veg Pizza">Non-Veg Pizza</option>
                            <option value="Mocktails">Mocktails</option>
                            <option value="Juice">Juice</option>
                            <option value="Maggie">Maggie</option>
                            <option value="Pasta">Pasta</option>
                            <option value="Shakes">Shakes</option>
                            <option value="Waffles">Waffles</option>
                            <option value="French Fries">French Fries</option>
                            <option value="Desserts">Desserts</option>
                        </select>
                    </div>
                    <div>
                        <label for="itemImage" class="block text-gray-700 font-medium mb-2">Image URL (Optional)</label>
                        <input type="text" id="itemImage" class="input-field w-full" placeholder="Image URL">
                    </div>
                    <div class="md:col-span-2">
                        <label for="itemImageUpload" class="block text-gray-700 font-medium mb-2">Upload Image (Optional)</label>
                        <input type="file" id="itemImageUpload" class="input-field w-full" accept="image/*">
                    </div>
                    <div class="md:col-span-2">
                        <label for="itemDescription" class="block text-gray-700 font-medium mb-2">Description</label>
                        <textarea id="itemDescription" class="input-field w-full" rows="4" placeholder="Item Description"></textarea>
                    </div>
                </div>
                <div class="mt-6">
                    <button onclick="addMenuItem()" class="auth-btn text-white w-full">Add Item</button>
                </div>
            </div>
            <!-- Menu Items Table -->
            <div class="bg-white p-8 rounded-lg shadow-md">
                <h4 class="text-xl font-medium text-gray-700 mb-6">Menu Items</h4>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Name</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="menuTableBody"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Order Management Section -->
        <section id="ordersSection" class="mb-12 hidden">
            <h3 class="text-3xl font-semibold text-gray-800 mb-6">Manage Orders</h3>
            <div class="bg-white p-8 rounded-lg shadow-md">
                <h4 class="text-xl font-medium text-gray-700 mb-6">Orders</h4>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Payment</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="orderTableBody"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Special Offers Section -->
        <section id="offersSection" class="mb-12 hidden">
            <h3 class="text-3xl font-semibold text-gray-800 mb-6">Manage Special Offers</h3>
            <!-- Add Offer Form -->
            <div class="bg-white p-8 rounded-lg shadow-md mb-8">
                <h4 class="text-xl font-medium text-gray-700 mb-6">Add New Offer</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="offerName" class="block text-gray-700 font-medium mb-2">Offer Name</label>
                        <input type="text" id="offerName" class="input-field w-full" placeholder="Offer Name">
                    </div>
                    <div>
                        <label for="offerPrice" class="block text-gray-700 font-medium mb-2">Price (₹)</label>
                        <input type="number" id="offerPrice" class="input-field w-full" placeholder="Price">
                    </div>
                    <div>
                        <label for="offerImage" class="block text-gray-700 font-medium mb-2">Image URL (Optional)</label>
                        <input type="text" id="offerImage" class="input-field w-full" placeholder="Image URL">
                    </div>
                    <div>
                        <label for="offerImageUpload" class="block text-gray-700 font-medium mb-2">Upload Image (Optional)</label>
                        <input type="file" id="offerImageUpload" class="input-field w-full" accept="image/*">
                    </div>
                    <div class="md:col-span-2">
                        <label for="offerDescription" class="block text-gray-700 font-medium mb-2">Description</label>
                        <textarea id="offerDescription" class="input-field w-full" rows="4" placeholder="Offer Description"></textarea>
                    </div>
                </div>
                <div class="mt-6">
                    <button onclick="addOffer()" class="auth-btn text-white w-full">Add Offer</button>
                </div>
            </div>
            <!-- Offers Table -->
            <div class="bg-white p-8 rounded-lg shadow-md">
                <h4 class="text-xl font-medium text-gray-700 mb-6">Special Offers</h4>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Name</th>
                                <th>Price</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="offerTableBody"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Coupons Management Section -->
        <section id="couponsSection" class="mb-12 hidden">
            <h3 class="text-3xl font-semibold text-gray-800 mb-6">Manage Coupons</h3>
            <!-- Add Coupon Form -->
            <div class="bg-white p-8 rounded-lg shadow-md mb-8">
                <h4 class="text-xl font-medium text-gray-700 mb-6">Add New Coupon</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="couponCode" class="block text-gray-700 font-medium mb-2">Coupon Code</label>
                    <input type="text" id="couponCode" class="input-field w-full" placeholder="Coupon Code">
                </div>
                <div>
                    <label for="couponDiscount" class="block text-gray-700 font-medium mb-2">Discount (%)</label>
                    <input type="number" id="couponDiscount" class="input-field w-full" placeholder="Discount Percentage" min="1" max="100">
                </div>
                <div>
                    <label for="couponImage" class="block text-gray-700 font-medium mb-2">Image URL (Optional)</label>
                    <input type="text" id="couponImage" class="input-field w-full" placeholder="Image URL">
                </div>
                <div>
                    <label for="couponImageUpload" class="block text-gray-700 font-medium mb-2">Upload Image (Optional)</label>
                    <input type="file" id="couponImageUpload" class="input-field w-full" accept="image/*">
                </div>
                <div class="md:col-span-2">
                    <label for="couponDescription" class="block text-gray-700 font-medium mb-2">Description</label>
                    <textarea id="couponDescription" class="input-field w-full" rows="4" placeholder="Coupon Description"></textarea>
                </div>
            </div>
            <div class="mt-6">
                <button onclick="addCoupon()" class="auth-btn text-white w-full">Add Coupon</button>
            </div>
        </div>
        <!-- Coupons Table -->
        <div class="bg-white p-8 rounded-lg shadow-md">
            <h4 class="text-xl font-medium text-gray-700 mb-6">Coupons</h4>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>Code</th>
                            <th>Discount (%)</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="couponTableBody"></tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Customer Management Section -->
    <section id="customersSection" class="mb-12 hidden">
        <h3 class="text-3xl font-semibold text-gray-800 mb-6">Manage Customers</h3>
        <div class="bg-white p-8 rounded-lg shadow-md">
            <h4 class="text-xl font-medium text-gray-700 mb-6">Customers</h4>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="customerTableBody"></tbody>
                </table>
            </div>
        </div>
    </section>
</div>

<script>
    const BASE_URL = window.location.hostname === 'localhost' ? 'http://localhost:3000' : 'https://delicute.onrender.com';

    function showToast(message, type = 'success') {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.className = `toast ${type}`;
        toast.style.display = 'block';
        setTimeout(() => {
            toast.style.display = 'none';
        }, 3000);
    }

    function toggleDropdown() {
        const dropdown = document.getElementById('profileDropdown');
        dropdown.classList.toggle('active');
    }

    function showSection(section) {
        document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
        document.getElementById(`${section}Section`).classList.remove('hidden');
        toggleDropdown();
        if (section === 'menu') fetchMenuItems();
        else if (section === 'orders') fetchOrders();
        else if (section === 'offers') fetchOffers();
        else if (section === 'coupons') fetchCoupons();
        else if (section === 'customers') fetchCustomers();
        else if (section === 'profile') fetchAdminDetails();
    }

    function showModal(modalId) {
        document.getElementById(modalId).style.display = 'flex';
    }

    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
    }

    async function uploadImage(file) {
        if (!file) return null;
        const formData = new FormData();
        formData.append('file', file);
        try {
            const response = await fetch(`${BASE_URL}/api/files/upload`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                body: formData
            });
            const data = await response.json();
            if (response.ok) return data.fileUrl;
            showToast(data.error || 'Failed to upload image.', 'error');
            return null;
        } catch (error) {
            console.error('Error uploading image:', error);
            showToast('Failed to upload image.', 'error');
            return null;
        }
    }

    async function fetchAdminDetails() {
        try {
            const response = await fetch(`${BASE_URL}/api/auth/admin/me`, {
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                }
            });
            const data = await response.json();
            if (response.ok) {
                document.getElementById('welcomeMessage').textContent = `Welcome, ${data.name || 'Admin'}`;
                document.getElementById('profileName').value = data.name || '';
                document.getElementById('profileEmail').value = data.email || '';
                document.getElementById('profilePhone').value = data.phone || '';
                document.getElementById('displayProfileName').textContent = data.name || '';
                document.getElementById('displayProfileEmail').textContent = data.email || '';
                document.getElementById('displayProfilePhone').textContent = data.phone || '';
                if (data.profileImage) {
                    document.getElementById('profileImage').src = data.profileImage;
                    document.getElementById('modalProfileImage').src = data.profileImage;
                    document.getElementById('displayProfileImage').src = data.profileImage;
                }
            } else {
                showToast(data.error || 'Failed to fetch admin details.', 'error');
            }
        } catch (error) {
            console.error('Error fetching admin details:', error);
            showToast('Failed to fetch admin details.', 'error');
        }
    }

    async function updateProfileImage() {
        const file = document.getElementById('profileImageUpload').files[0];
        if (!file) {
            showToast('Please select an image.', 'error');
            return;
        }
        const imageUrl = await uploadImage(file);
        if (!imageUrl) return;
        try {
            const response = await fetch(`${BASE_URL}/api/auth/admin/profile`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                body: JSON.stringify({ profileImage: imageUrl })
            });
            const data = await response.json();
            if (response.ok) {
                showToast('Profile image updated successfully!', 'success');
                fetchAdminDetails();
                closeModal('profileModal');
            } else {
                showToast(data.error || 'Failed to update profile image.', 'error');
            }
        } catch (error) {
            console.error('Error updating profile image:', error);
            showToast('Failed to update profile image.', 'error');
        }
    }

    async function fetchMenuItems() {
        try {
            const response = await fetch(`${BASE_URL}/api/menu`, {
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                }
            });
            const items = await response.json();
            displayMenuItems(items);
            document.getElementById('totalMenuItems').textContent = items.length;
        } catch (error) {
            console.error('Error fetching menu items:', error);
            showToast('Failed to load menu items.', 'error');
        }
    }

    function displayMenuItems(items) {
        const menuTableBody = document.getElementById('menuTableBody');
        menuTableBody.innerHTML = items.map(item => `
            <tr class="border-b">
                <td class="py-2 px-4">
                    ${item.image ? `<img src="${item.image}" alt="${item.name}" class="menu-img">` : 'No Image'}
                </td>
                <td class="py-2 px-4">${item.name}</td>
                <td class="py-2 px-4">${item.category}</td>
                <td class="py-2 px-4">₹${item.price || 'N/A'}</td>
                <td class="py-2 px-4">
                    <button onclick="editMenuItem('${item._id}')" class="auth-btn bg-blue-500 hover:bg-blue-600 text-white px-3 py-1">Edit</button>
                    <button onclick="deleteMenuItem('${item._id}')" class="auth-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1">Delete</button>
                </td>
            </tr>
        `).join('');
    }

    async function addMenuItem() {
        const name = document.getElementById('itemName').value;
        const price = parseFloat(document.getElementById('itemPrice').value) || null;
        const category = document.getElementById('itemCategory').value;
        const imageUrl = document.getElementById('itemImage').value;
        const file = document.getElementById('itemImageUpload').files[0];
        const description = document.getElementById('itemDescription').value;

        if (!name || !category || !price) {
            showToast('Please fill in name, category, and price.', 'error');
            return;
        }

        const uploadedImageUrl = file ? await uploadImage(file) : imageUrl;
        if (file && !uploadedImageUrl) return;

        try {
            const response = await fetch(`${BASE_URL}/api/menu`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                body: JSON.stringify({
                    name,
                    price,
                    category,
                    image: uploadedImageUrl || null,
                    description
                })
            });
            const data = await response.json();
            if (response.ok) {
                showToast('Menu item added successfully!', 'success');
                document.getElementById('itemName').value = '';
                document.getElementById('itemPrice').value = '';
                document.getElementById('itemCategory').value = '';
                document.getElementById('itemImage').value = '';
                document.getElementById('itemImageUpload').value = '';
                document.getElementById('itemDescription').value = '';
                fetchMenuItems();
            } else {
                showToast(data.error || 'Failed to add menu item.', 'error');
            }
        } catch (error) {
            console.error('Error adding menu item:', error);
            showToast('Failed to add menu item.', 'error');
        }
    }

    function editMenuItem(itemId) {
        fetch(`${BASE_URL}/api/menu/${itemId}`, {
            headers: {
                'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
            }
        })
            .then(response => response.json())
            .then(item => {
                document.getElementById('editItemId').value = item._id;
                document.getElementById('editItemName').value = item.name;
                document.getElementById('editItemPrice').value = item.price || '';
                document.getElementById('editItemCategory').value = item.category;
                document.getElementById('editItemImage').value = item.image || '';
                document.getElementById('editItemDescription').value = item.description || '';
                showModal('editMenuModal');
            })
            .catch(error => {
                console.error('Error fetching menu item:', error);
                showToast('Failed to load menu item.', 'error');
            });
    }

    async function updateMenuItem() {
        const id = document.getElementById('editItemId').value;
        const name = document.getElementById('editItemName').value;
        const price = parseFloat(document.getElementById('editItemPrice').value) || null;
        const category = document.getElementById('editItemCategory').value;
        const imageUrl = document.getElementById('editItemImage').value;
        const file = document.getElementById('editItemImageUpload').files[0];
        const description = document.getElementById('editItemDescription').value;

        if (!name || !category || !price) {
            showToast('Please fill in name, category, and price.', 'error');
            return;
        }

        const uploadedImageUrl = file ? await uploadImage(file) : imageUrl;
        if (file && !uploadedImageUrl) return;

        try {
            const response = await fetch(`${BASE_URL}/api/menu/${id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                body: JSON.stringify({
                    name,
                    price,
                    category,
                    image: uploadedImageUrl || null,
                    description
                })
            });
            const data = await response.json();
            if (response.ok) {
                showToast('Menu item updated successfully!', 'success');
                closeModal('editMenuModal');
                fetchMenuItems();
            } else {
                showToast(data.error || 'Failed to update menu item.', 'error');
            }
        } catch (error) {
            console.error('Error updating menu item:', error);
            showToast('Failed to update menu item.', 'error');
        }
    }

    async function deleteMenuItem(itemId) {
        try {
            const response = await fetch(`${BASE_URL}/api/menu/${itemId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                }
            });
            const data = await response.json();
            if (response.ok) {
                showToast('Menu item deleted successfully!', 'success');
                fetchMenuItems();
            } else {
                showToast(data.error || 'Failed to delete menu item.', 'error');
            }
        } catch (error) {
            console.error('Error deleting menu item:', error);
            showToast('Failed to delete menu item.', 'error');
        }
    }

    async function fetchOrders() {
        try {
            const response = await fetch(`${BASE_URL}/api/orders`, {
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                }
            });
            const orders = await response.json();
            displayOrders(orders);
            document.getElementById('totalOrders').textContent = orders.length;
            document.getElementById('pendingOrders').textContent = orders.filter(order => order.status === 'Pending').length;
        } catch (error) {
            console.error('Error fetching orders:', error);
            showToast('Failed to load orders.', 'error');
        }
    }

    function displayOrders(orders) {
        const orderTableBody = document.getElementById('orderTableBody');
        orderTableBody.innerHTML = orders.map(order => `
            <tr class="border-b">
                <td class="py-2 px-4">${order._id}</td>
                <td class="py-2 px-4">${order.customerName || 'N/A'}</td>
                <td class="py-2 px-4">₹${order.total}</td>
                <td class="py-2 px-4">${order.status}</td>
                <td class="py-2 px-4">${order.paymentStatus || 'Pending'}</td>
                <td class="py-2 px-4">
                    <select onchange="updateOrderStatus('${order._id}', this.value)" class="input-field p-1 border rounded-md">
                        <option value="Pending" ${order.status === 'Pending' ? 'selected' : ''}>Pending</option>
                        <option value="Confirmed" ${order.status === 'Confirmed' ? 'selected' : ''}>Confirmed</option>
                        <option value="Delivered" ${order.status === 'Delivered' ? 'selected' : ''}>Delivered</option>
                        <option value="Cancelled" ${order.status === 'Cancelled' ? 'selected' : ''}>Cancelled</option>
                    </select>
                    ${order.paymentStatus === 'Paid' ? `<button onclick="refundOrder('${order._id}')" class="auth-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 mt-2">Refund</button>` : ''}
                </td>
            </tr>
        `).join('');
    }

    async function updateOrderStatus(orderId, status) {
        try {
            const response = await fetch(`${BASE_URL}/api/orders/${orderId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                body: JSON.stringify({ status })
            });
            const data = await response.json();
            if (response.ok) {
                showToast(`Order status updated to ${status}!`, 'success');
                fetchOrders();
            } else {
                showToast(data.error || 'Failed to update order status.', 'error');
            }
        } catch (error) {
            console.error('Error updating order status:', error);
            showToast('Failed to update order status.', 'error');
        }
    }

    async function refundOrder(orderId) {
        try {
            const response = await fetch(`${BASE_URL}/api/orders/${orderId}/refund`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                }
            });
            const data = await response.json();
            if (response.ok) {
                showToast('Order refunded successfully!', 'success');
                fetchOrders();
            } else {
                showToast(data.error || 'Failed to process refund.', 'error');
            }
        } catch (error) {
            console.error('Error processing refund:', error);
            showToast('Failed to process refund.', 'error');
        }
    }

    async function fetchOffers() {
        try {
            const response = await fetch(`${BASE_URL}/api/offers`, {
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                }
            });
            const offers = await response.json();
            displayOffers(offers);
        } catch (error) {
            console.error('Error fetching offers:', error);
            showToast('Failed to load offers.', 'error');
        }
    }

    function displayOffers(offers) {
        const offerTableBody = document.getElementById('offerTableBody');
        offerTableBody.innerHTML = offers.map(offer => `
            <tr class="border-b">
                <td class="py-2 px-4">
                    ${offer.image ? `<img src="${offer.image}" alt="${offer.name}" class="menu-img">` : 'No Image'}
                </td>
                <td class="py-2 px-4">${offer.name}</td>
                <td class="py-2 px-4">₹${offer.price}</td>
                <td class="py-2 px-4">
                    <button onclick="editOffer('${offer._id}')" class="auth-btn bg-blue-500 hover:bg-blue-600 text-white px-3 py-1">Edit</button>
                    <button onclick="deleteOffer('${offer._id}')" class="auth-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1">Delete</button>
                </td>
            </tr>
        `).join('');
    }

    async function addOffer() {
        const name = document.getElementById('offerName').value;
        const price = parseFloat(document.getElementById('offerPrice').value) || null;
        const imageUrl = document.getElementById('offerImage').value;
        const file = document.getElementById('offerImageUpload').files[0];
        const description = document.getElementById('offerDescription').value;

        if (!name || !price) {
            showToast('Please fill in offer name and price.', 'error');
            return;
        }

        const uploadedImageUrl = file ? await uploadImage(file) : imageUrl;
        if (file && !uploadedImageUrl) return;

        try {
            const response = await fetch(`${BASE_URL}/api/offers`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                body: JSON.stringify({
                    name,
                    price,
                    image: uploadedImageUrl || null,
                    description
                })
            });
            const data = await response.json();
            if (response.ok) {
                showToast('Offer added successfully!', 'success');
                document.getElementById('offerName').value = '';
                document.getElementById('offerPrice').value = '';
                document.getElementById('offerImage').value = '';
                document.getElementById('offerImageUpload').value = '';
                document.getElementById('offerDescription').value = '';
                fetchOffers();
            } else {
                showToast(data.error || 'Failed to add offer.', 'error');
            }
        } catch (error) {
            console.error('Error adding offer:', error);
            showToast('Failed to add offer.', 'error');
        }
    }

    function editOffer(id) {
        fetch(`${BASE_URL}/api/offers/${id}`, {
            headers: {
                'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
            }
        })
            .then(response => response.json())
            .then(offer => {
                document.getElementById('editOfferId').value = offer._id;
                document.getElementById('editOfferName').value = offer.name;
                document.getElementById('editOfferPrice').value = offer.price || '';
                document.getElementById('editOfferImage').value = offer.image || '';
                document.getElementById('editOfferDescription').value = offer.description || '';
                showModal('editOfferModal');
            })
            .catch(error => {
                console.error('Error fetching offer:', error);
                showToast('Failed to load offer.', 'error');
            });
    }

    async function updateOffer() {
        const id = document.getElementById('editOfferId').value;
        const name = document.getElementById('editOfferName').value;
        const price = parseFloat(document.getElementById('editOfferPrice').value) || null;
        const imageUrl = document.getElementById('editOfferImage').value;
        const file = document.getElementById('editOfferImageUpload').files[0];
        const description = document.getElementById('editOfferDescription').value;

        if (!name || !price) {
            showToast('Please fill in offer name and price.', 'error');
            return;
        }

        const uploadedImageUrl = file ? await uploadImage(file) : imageUrl;
        if (file && !uploadedImageUrl) return;

        try {
            const response = await fetch(`${BASE_URL}/api/offers/${id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                body: JSON.stringify({
                    name,
                    price,
                    image: uploadedImageUrl || null,
                    description
                })
            });
            const data = await response.json();
            if (response.ok) {
                showToast('Offer updated successfully!', 'success');
                closeModal('editOfferModal');
                fetchOffers();
            } else {
                showToast(data.error || 'Failed to update offer.', 'error');
            }
        } catch (error) {
            console.error('Error updating offer:', error);
            showToast('Failed to update offer.', 'error');
        }
    }

    async function deleteOffer(id) {
        try {
            const response = await fetch(`${BASE_URL}/api/offers/${id}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                }
            });
            const data = await response.json();
            if (response.ok) {
                showToast('Offer deleted successfully!', 'success');
                fetchOffers();
            } else {
                showToast(data.error || 'Failed to delete offer.', 'error');
            }
        } catch (error) {
            console.error('Error deleting offer:', error);
            showToast('Failed to delete offer.', 'error');
        }
    }

    async function fetchCoupons() {
        try {
            const response = await fetch(`${BASE_URL}/api/coupons`, {
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                }
            });
            const coupons = await response.json();
            displayCoupons(coupons);
        } catch (error) {
            console.error('Error fetching coupons:', error);
            showToast('Failed to load coupons.', 'error');
        }
    }

    function displayCoupons(coupons) {
        const couponTableBody = document.getElementById('couponTableBody');
        couponTableBody.innerHTML = coupons.map(coupon => `
            <tr class="border-b">
                <td class="py-2 px-4">
                    ${coupon.image ? `<img src="${coupon.image}" alt="${coupon.code}" class="menu-img">` : 'No Image'}
                </td>
                <td class="py-2 px-4">${coupon.code}</td>
                <td class="py-2 px-4">${coupon.discount}%</td>
                <td class="py-2 px-4">
                    <button onclick="editCoupon('${coupon._id}')" class="auth-btn bg-blue-500 hover:bg-blue-600 text-white px-3 py-1">Edit</button>
                    <button onclick="deleteCoupon('${coupon._id}')" class="auth-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1">Delete</button>
                </td>
            </tr>
        `).join('');
    }

    async function addCoupon() {
        const code = document.getElementById('couponCode').value;
        const discount = parseFloat(document.getElementById('couponDiscount').value) || null;
        const imageUrl = document.getElementById('couponImage').value;
        const file = document.getElementById('couponImageUpload').files[0];
        const description = document.getElementById('couponDescription').value;

        if (!code || !discount) {
            showToast('Please fill in coupon code and discount percentage.', 'error');
            return;
        }

        if (discount < 1 || discount > 100) {
            showToast('Discount must be between 1% and 100%.', 'error');
            return;
        }

        const uploadedImageUrl = file ? await uploadImage(file) : imageUrl;
        if (file && !uploadedImageUrl) return;

        try {
            const response = await fetch(`${BASE_URL}/api/coupons`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                body: JSON.stringify({
                    code,
                    discount,
                    image: uploadedImageUrl || null,
                    description
                })
            });
            const data = await response.json();
            if (response.ok) {
                showToast('Coupon added successfully!', 'success');
                document.getElementById('couponCode').value = '';
                document.getElementById('couponDiscount').value = '';
                document.getElementById('couponImage').value = '';
                document.getElementById('couponImageUpload').value = '';
                document.getElementById('couponDescription').value = '';
                fetchCoupons();
            } else {
                showToast(data.error || 'Failed to add coupon.', 'error');
            }
        } catch (error) {
            console.error('Error adding coupon:', error);
            showToast('Failed to add coupon.', 'error');
        }
    }

    function editCoupon(id) {
        fetch(`${BASE_URL}/api/coupons/${id}`, {
            headers: {
                'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
            }
        })
            .then(response => response.json())
            .then(coupon => {
                document.getElementById('editCouponId').value = coupon._id;
                document.getElementById('editCouponCode').value = coupon.code;
                document.getElementById('editCouponDiscount').value = coupon.discount || '';
                document.getElementById('editCouponImage').value = coupon.image || '';
                document.getElementById('editCouponDescription').value = coupon.description || '';
                showModal('editCouponModal');
            })
            .catch(error => {
                console.error('Error fetching coupon:', error);
                showToast('Failed to load coupon.', 'error');
            });
    }

    async function updateCoupon() {
        const id = document.getElementById('editCouponId').value;
        const code = document.getElementById('editCouponCode').value;
        const discount = parseFloat(document.getElementById('editCouponDiscount').value) || null;
        const imageUrl = document.getElementById('editCouponImage').value;
        const file = document.getElementById('editCouponImageUpload').files[0];
        const description = document.getElementById('editCouponDescription').value;

        if (!code || !discount) {
            showToast('Please fill in coupon code and discount percentage.', 'error');
            return;
        }

        if (discount < 1 || discount > 100) {
            showToast('Discount must be between 1% and 100%.', 'error');
            return;
        }

        const uploadedImageUrl = file ? await uploadImage(file) : imageUrl;
        if (file && !uploadedImageUrl) return;

        try {
            const response = await fetch(`${BASE_URL}/api/coupons/${id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                body: JSON.stringify({
                    code,
                    discount,
                    image: uploadedImageUrl || null,
                    description
                })
            });
            const data = await response.json();
            if (response.ok) {
                showToast('Coupon updated successfully!', 'success');
                closeModal('editCouponModal');
                fetchCoupons();
            } else {
                showToast(data.error || 'Failed to update coupon.', 'error');
            }
        } catch (error) {
            console.error('Error updating coupon:', error);
            showToast('Failed to update coupon.', 'error');
        }
    }

    async function deleteCoupon(id) {
        try {
            const response = await fetch(`${BASE_URL}/api/coupons/${id}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                }
            });
            const data = await response.json();
            if (response.ok) {
                showToast('Coupon deleted successfully!', 'success');
                fetchCoupons();
            } else {
                showToast(data.error || 'Failed to delete coupon.', 'error');
            }
        } catch (error) {
            console.error('Error deleting coupon:', error);
            showToast('Failed to delete coupon.', 'error');
        }
    }

    async function fetchCustomers() {
        try {
            const response = await fetch(`${BASE_URL}/api/customers`, {
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                }
            });
            const customers = await response.json();
            displayCustomers(customers);
        } catch (error) {
            console.error('Error fetching customers:', error);
            showToast('Failed to load customers.', 'error');
        }
    }

    function displayCustomers(customers) {
        const customerTableBody = document.getElementById('customerTableBody');
        customerTableBody.innerHTML = customers.map(customer => `
            <tr class="border-b">
                <td class="py-2 px-4">${customer.name}</td>
                <td class="py-2 px-4">${customer.email}</td>
                <td class="py-2 px-4">${customer.phone || 'N/A'}</td>
                <td class="py-2 px-4">${customer.isBlocked ? 'Blocked' : 'Active'}</td>
                <td class="py-2 px-4">
                    <button onclick="viewCustomerDetails('${customer._id}')" class="auth-btn bg-blue-500 hover:bg-blue-600 text-white px-3 py-1">View</button>
                </td>
            </tr>
        `).join('');
    }

    async function viewCustomerDetails(customerId) {
        try {
            const response = await fetch(`${BASE_URL}/api/customers/${customerId}`, {
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                }
            });
            const customer = await response.json();
            document.getElementById('customerName').textContent = customer.name;
            document.getElementById('customerEmail').textContent = customer.email;
            document.getElementById('customerPhone').textContent = customer.phone || 'N/A';
            document.getElementById('customerStatus').textContent = customer.isBlocked ? 'Blocked' : 'Active';
            document.getElementById('blockUnblockBtn').textContent = customer.isBlocked ? 'Unblock' : 'Block';
            document.getElementById('blockUnblockBtn').onclick = () => toggleCustomerBlock(customerId, !customer.isBlocked);

            const ordersResponse = await fetch(`${BASE_URL}/api/orders/customer/${customerId}`, {
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                }
            });
            const orders = await ordersResponse.json();
            const orderHistory = document.getElementById('customerOrderHistory');
            orderHistory.innerHTML = orders.length > 0 ? orders.map(order => `
                <div class="border-b py-2">
                    <p><strong>Order ID:</strong> ${order._id}</p>
                    <p><strong>Total:</strong> ₹${order.total}</p>
                    <p><strong>Status:</strong> ${order.status}</p>
                </div>
            `).join('') : '<p>No orders found.</p>';

            showModal('customerDetailsModal');
        } catch (error) {
            console.error('Error viewing customer details:', error);
            showToast('Failed to load customer details.', 'error');
        }
    }

    async function toggleCustomerBlock(customerId, block) {
        try {
            const response = await fetch(`${BASE_URL}/api/customers/${customerId}/block`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                body: JSON.stringify({ isBlocked: block })
            });
            const data = await response.json();
            if (response.ok) {
                showToast(`Customer ${block ? 'blocked' : 'unblocked'} successfully!`, 'success');
                closeModal('customerDetailsModal');
                fetchCustomers();
            } else {
                showToast(data.error || `Failed to ${block ? 'block' : 'unblock'} customer.`, 'error');
            }
        } catch (error) {
            console.error(`Error ${block ? 'blocking' : 'unblocking'} customer:`, error);
            showToast(`Failed to ${block ? 'block' : 'unblock'} customer.`, 'error');
        }
    }

    async function toggleRestaurantStatus() {
        try {
            const currentStatus = document.getElementById('restaurantStatus').textContent;
            const newStatus = currentStatus === 'Open' ? 'Closed' : 'Open';
            const response = await fetch(`${BASE_URL}/api/restaurant-status`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                body: JSON.stringify({ status: newStatus })
            });
            const data = await response.json();
            if (response.ok) {
                document.getElementById('restaurantStatus').textContent = newStatus;
                document.getElementById('statusToggleBtn').textContent = newStatus === 'Open' ? 'Close Restaurant' : 'Open Restaurant';
                showToast(`Restaurant is now ${newStatus}!`, 'success');
            } else {
                showToast(data.error || 'Failed to update restaurant status.', 'error');
            }
        } catch (error) {
            console.error('Error updating restaurant status:', error);
            showToast('Failed to update restaurant status.', 'error');
        }
    }

    function logout() {
        localStorage.removeItem('adminToken');
        showToast('Logged out successfully!', 'success');
        setTimeout(() => {
            window.location.href = '/admin.html';
        }, 1000);
    }

    window.onload = () => {
        const adminToken = localStorage.getItem('adminToken');
        if (!adminToken) {
            showToast('Please log in to access the admin panel.', 'error');
            setTimeout(() => {
                window.location.href = '/admin.html';
            }, 1000);
            return;
        }
        fetchAdminDetails();
        fetchMenuItems();
        fetchOrders();
        fetchOffers();
        fetchCoupons();
        fetchCustomers();
        fetch(`${BASE_URL}/api/restaurant-status`, {
            headers: {
                'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
            }
        })
            .then(response => response.json())
            .then(data => {
                document.getElementById('restaurantStatus').textContent = data.status || 'Closed';
                document.getElementById('statusToggleBtn').textContent = data.status === 'Open' ? 'Close Restaurant' : 'Open Restaurant';
            })
            .catch(error => {
                console.error('Error fetching restaurant status:', error);
                showToast('Failed to fetch restaurant status.', 'error');
            });
        showSection('home');
    };
</script>
</body>
</html>