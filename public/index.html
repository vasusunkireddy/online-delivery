<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://accounts.google.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; img-src 'self' data: https://images.unsplash.com https://i.imgur.com; connect-src 'self' http://localhost:3000 https://delicute.onrender.com; font-src 'self' https://cdnjs.cloudflare.com; frame-src 'self' https://accounts.google.com;">
  <title>DELICUTE - Cloud Kitchen</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      overscroll-behavior-y: none;
    }
    .section {
      min-height: calc(100vh - 64px);
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .nav-link {
      transition: color 0.2s ease-in-out;
    }
    .nav-link:hover {
      color: #fed7aa;
    }
    #mobileMenu a {
      font-size: 1.1rem;
    }
    .form-input {
      transition: all 0.3s ease;
    }
    .form-input:focus {
      border-color: #f97316;
      box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.2);
    }
    @media (max-width: 640px) {
      .container {
        padding-left: 1rem;
        padding-right: 1rem;
      }
      #loginForm, #signupForm {
        padding: 1.5rem;
      }
      .section {
        padding-top: 4rem;
        padding-bottom: 4rem;
      }
      #menuItems img {
        height: 10rem;
      }
    }
    #toast {
      transform: translateX(100%);
      transition: transform 0.3s ease-in-out;
    }
    #toast:not(.hidden) {
      transform: translateX(0);
    }
  </style>
</head>
<body class="bg-gray-100">
  <nav class="bg-orange-600 text-white p-4 sticky top-0 z-10 shadow-md">
    <div class="container mx-auto flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <img src="https://i.imgur.com/ZbhzFqT.png" alt="DELICUTE Logo" class="h-8">
        <div class="text-2xl font-bold">DELICUTE</div>
      </div>
      <div class="hidden md:flex space-x-6">
        <a href="#" data-section="home" class="nav-link hover:underline">Home</a>
        <a href="#" data-section="login" id="loginNav" class="nav-link hover:underline">Login</a>
        <a href="#" data-section="terms" class="nav-link hover:underline">Terms</a>
        <a href="#" data-section="privacy" class="nav-link hover:underline">Privacy</a>
      </div>
      <button id="menuToggle" class="md:hidden focus:outline-none">
        <i class="fas fa-bars text-xl"></i>
      </button>
    </div>
    <div id="mobileMenu" class="hidden md:hidden bg-orange-600 p-4">
      <a href="#" data-section="home" class="nav-link block py-2 hover:underline">Home</a>
      <a href="#" data-section="login" id="mobileLoginNav" class="nav-link block py-2 hover:underline">Login</a>
      <a href="#" data-section="terms" class="nav-link block py-2 hover:underline">Terms</a>
      <a href="#" data-section="privacy" class="nav-link block py-2 hover:underline">Privacy</a>
    </div>
  </nav>
  <section id="login" class="section py-16 bg-gray-100">
    <div class="container mx-auto max-w-md">
      <div class="bg-white rounded-lg shadow-lg p-8">
        <div class="text-center mb-8">
          <img src="https://i.imgur.com/ZbhzFqT.png" alt="DELICUTE Logo" class="h-12 mx-auto">
          <h1 class="text-3xl font-bold text-orange-600">DELICUTE</h1>
          <p class="text-gray-600 italic">Every bite tells a story</p>
        </div>
        <div class="flex justify-center mb-6">
          <button id="loginTab" class="px-4 py-2 text-orange-600 font-semibold border-b-2 border-orange-600">Login</button>
          <button id="signupTab" class="px-4 py-2 text-gray-600 font-semibold">Signup</button>
        </div>
        <form id="loginForm" class="space-y-6">
          <div>
            <label for="loginEmail" class="block text-gray-700 font-medium">Email</label>
            <div class="relative">
              <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                <i class="fas fa-envelope text-gray-400"></i>
              </span>
              <input type="email" id="loginEmail" class="form-input w-full pl-10 pr-3 py-2 border rounded-lg focus:outline-none" placeholder="Enter your email" required aria-required="true">
            </div>
          </div>
          <div>
            <label for="loginPassword" class="block text-gray-700 font-medium">Password</label>
            <div class="relative">
              <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                <i class="fas fa-lock text-gray-400"></i>
              </span>
              <input type="password" id="loginPassword" class="form-input w-full pl-10 pr-3 py-2 border rounded-lg focus:outline-none" placeholder="Enter your password" required aria-required="true">
            </div>
          </div>
          <div class="flex justify-between items-center">
            <a href="#" id="forgotPassword" class="text-sm text-orange-600 hover:underline">Forgot Password?</a>
          </div>
          <button type="submit" class="w-full bg-orange-600 text-white py-2 rounded-lg hover:bg-orange-700 transition focus:outline-none focus:ring-2 focus:ring-orange-600">Login</button>
        </form>
        <form id="signupForm" class="space-y-6 hidden">
          <div>
            <label for="signupName" class="block text-gray-700 font-medium">Full Name</label>
            <div class="relative">
              <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                <i class="fas fa-user text-gray-400"></i>
              </span>
              <input type="text" id="signupName" class="form-input w-full pl-10 pr-3 py-2 border rounded-lg focus:outline-none" placeholder="Enter your full name" required aria-required="true">
            </div>
            <p id="signupNameError" class="text-red-500 text-sm mt-1 hidden">Name must be at least 3 characters long.</p>
          </div>
          <div>
            <label for="signupEmail" class="block text-gray-700 font-medium">Email</label>
            <div class="relative">
              <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                <i class="fas fa-envelope text-gray-400"></i>
              </span>
              <input type="email" id="signupEmail" class="form-input w-full pl-10 pr-3 py-2 border rounded-lg focus:outline-none" placeholder="Enter your email" required aria-required="true">
            </div>
            <p id="signupEmailError" class="text-red-500 text-sm mt-1 hidden">Please enter a valid email address. Disposable emails are not allowed.</p>
          </div>
          <div>
            <label for="signupPhone" class="block text-gray-700 font-medium">Phone</label>
            <div class="relative">
              <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                <i class="fas fa-phone text-gray-400"></i>
              </span>
              <input type="tel" id="signupPhone" class="form-input w-full pl-10 pr-3 py-2 border rounded-lg focus:outline-none" placeholder="Enter your phone number" required aria-required="true">
            </div>
            <p id="signupPhoneError" class="text-red-500 text-sm mt-1 hidden">Phone number must be 10 digits long.</p>
          </div>
          <div>
            <label for="signupPassword" class="block text-gray-700 font-medium">Password</label>
            <div class="relative">
              <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                <i class="fas fa-lock text-gray-400"></i>
              </span>
              <input type="password" id="signupPassword" class="form-input w-full pl-10 pr-3 py-2 border rounded-lg focus:outline-none" placeholder="Enter your password" required aria-required="true">
            </div>
            <p id="signupPasswordError" class="text-red-500 text-sm mt-1 hidden">Password must be at least 8 characters long.</p>
          </div>
          <div>
            <label for="signupAddress" class="block text-gray-700 font-medium">Delivery Address</label>
            <div class="relative">
              <span class="absolute top-3 left-0 flex items-start pl-3">
                <i class="fas fa-map-marker-alt text-gray-400"></i>
              </span>
              <textarea id="signupAddress" class="form-input w-full pl-10 pr-3 py-2 border rounded-lg focus:outline-none" placeholder="Enter your delivery address" rows="3" required aria-required="true"></textarea>
            </div>
            <p id="signupAddressError" class="text-red-500 text-sm mt-1 hidden">Address cannot be empty.</p>
          </div>
          <div class="flex items-center space-x-4">
            <div class="flex-1">
              <label for="signupOtp" class="block text-gray-700 font-medium">OTP</label>
              <input type="text" id="signupOtp" class="form-input w-full px-3 py-2 border rounded-lg focus:outline-none" placeholder="Enter OTP" required aria-required="true">
              <p id="signupOtpError" class="text-red-500 text-sm mt-1 hidden">OTP must be 6 digits long.</p>
            </div>
            <button type="button" id="sendOtpButton" class="mt-6 text-sm text-orange-600 hover:underline focus:outline-none flex items-center">
              <span id="sendOtpButtonText">Send OTP</span>
              <span id="otpTimer" class="ml-1 hidden">(<span id="otpTimerCount">30</span>s)</span>
              <svg id="otpLoadingSpinner" class="animate-spin h-4 w-4 ml-1 text-orange-600 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
            </button>
          </div>
          <button type="submit" id="signupButton" class="w-full bg-orange-600 text-white py-2 rounded-lg hover:bg-orange-700 transition focus:outline-none focus:ring-2 focus:ring-orange-600 flex justify-center items-center">
            <span id="signupButtonText">Sign Up</span>
            <svg id="signupLoadingSpinner" class="animate-spin h-5 w-5 ml-2 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          </button>
        </form>
        <div class="text-center mt-6">
          <p class="text-gray-600">Or continue with</p>
          <div class="flex justify-center mt-4">
            <div id="googleSignInButton"></div>
          </div>
        </div>
        <div id="forgotPasswordModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div class="bg-white rounded-lg p-6 w-full max-w-sm">
            <h2 class="text-xl font-bold text-orange-600 mb-4">Reset Password</h2>
            <div id="emailStep" class="space-y-4">
              <div>
                <label for="resetEmail" class="block text-gray-700 font-medium">Email</label>
                <input type="email" id="resetEmail" class="form-input w-full px-3 py-2 border rounded-lg focus:outline-none" placeholder="Enter your email" required aria-required="true">
              </div>
              <button id="sendOtp" class="w-full bg-orange-600 text-white py-2 rounded-lg hover:bg-orange-700 transition focus:outline-none focus:ring-2 focus:ring-orange-600">Send OTP</button>
            </div>
            <div id="otpStep" class="space-y-4 hidden">
              <div>
                <label for="otpInput" class="block text-gray-700 font-medium">OTP</label>
                <input type="text" id="otpInput" class="form-input w-full px-3 py-2 border rounded-lg focus:outline-none" placeholder="Enter OTP" required aria-required="true">
              </div>
              <div>
                <label for="newPassword" class="block text-gray-700 font-medium">New Password</label>
              </div>
              <div class="flex justify-between items-center">
                <button id="resendResetOtp" class="text-sm text-orange-600 hover:underline focus:outline-none" disabled>Resend OTP (<span id="resendResetTimer">30</span>s)</button>
              </div>
              <button id="resetPassword" class="w-full bg-orange-600 text-white py-2 rounded-lg hover:bg-orange-700 transition focus:outline-none focus:ring-2 focus:ring-orange-600">Reset Password</button>
            </div>
            <button id="closeModal" class="mt-4 text-sm text-orange-600 hover:underline focus:outline-none">Close</button>
          </div>
        </div>
        <div class="text-center mt-6">
          <p class="text-gray-600 text-sm">By signing up, you agree to our <a href="#" data-section="terms" class="nav-link text-orange-600 hover:underline">Terms</a> and <a href="#" data-section="privacy" class="nav-link text-orange-600 hover:underline">Privacy Policy</a>.</p>
        </div>
      </div>
    </div>
  </section>
  <section id="home" class="section hidden py-16">
    <div class="bg-orange-100 py-16 text-center">
      <div class="container mx-auto">
        <img src="https://i.imgur.com/ZbhzFqT.png" alt="DELICUTE Logo" class="h-16 mx-auto">
        <h1 class="text-4xl md:text-5xl font-bold text-orange-600">DELICUTE</h1>
        <p class="text-xl italic text-gray-600 mt-2">Every bite tells a story</p>
        <p class="text-lg text-gray-700 mt-4">Order delicious Indian meals delivered to your door!</p>
        <button id="orderNow" class="mt-6 inline-block bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 transition focus:outline-none focus:ring-2 focus:ring-orange-600">Order Now</button>
      </div>
    </div>
    <div id="menuSection" class="py-16 hidden">
      <div class="container mx-auto">
        <h2 class="text-3xl font-bold text-center text-orange-600 mb-8">Our Menu</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6" id="menuItems"></div>
      </div>
    </div>
    <div id="loginPrompt" class="py-16 text-center">
      <p class="text-xl text-gray-700">Please <a href="#" data-section="login" class="nav-link text-orange-600 hover:underline">login</a> to view our menu and place orders.</p>
    </div>
    <div class="py-16 bg-gray-200">
      <div class="container mx-auto">
        <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
          <input type="text" id="searchDishes" placeholder="Search dishes..." class="w-full md:w-1/3 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-600">
          <div class="flex flex-wrap gap-2">
            <button class="filter-btn bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700" data-category="Vegetarian">Vegetarian</button>
            <button class="filter-btn bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700" data-category="Non-Veg">Non-Veg</button>
            <button class="filter-btn bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700" data-category="Desserts">Desserts</button>
          </div>
        </div>
      </div>
    </div>
    <div class="py-16">
      <div class="container mx-auto text-center">
        <h2 class="text-3xl font-bold text-orange-600 mb-8">Special Offers</h2>
        <p class="text-xl text-gray-700">Get ₹100 off your first order! Use code: DELICUTE100</p>
      </div>
    </div>
    <div class="py-16 bg-gray-200">
      <div class="container mx-auto">
        <h2 class="text-3xl font-bold text-center text-orange-600 mb-8">What Our Customers Say</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="bg-white p-6 rounded-lg shadow-lg">
            <p class="text-gray-600">"The Butter Chicken was absolutely delicious!"</p>
            <p class="mt-4 font-semibold text-orange-600">- Priya S.</p>
          </div>
          <div class="bg-white p-6 rounded-lg shadow-lg">
            <p class="text-gray-600">"Fast delivery and amazing Gulab Jamun!"</p>
            <p class="mt-4 font-semibold text-orange-600">- Rahul M.</p>
          </div>
        </div>
      </div>
    </div>
    <footer class="bg-orange-600 text-white py-8">
      <div class="container mx-auto text-center">
        <p class="text-lg">DELICUTE - Every bite tells a story</p>
        <div class="mt-4 space-x-4">
          <a href="#" data-section="terms" class="nav-link hover:underline">Terms</a>
          <a href="#" data-section="privacy" class="nav-link hover:underline">Privacy Policy</a>
          <a href="/cdn-cgi/l/email-protection#5d2e282d2d322f291d393831343e282938733e3230" class="hover:underline">Contact</a>
          <a href="#" class="hover:underline">About</a>
        </div>
      </div>
    </footer>
  </section>
  <section id="terms" class="section hidden py-16">
    <div class="container mx-auto max-w-3xl">
      <div class="flex items-center space-x-2 mb-6">
        <img src="https://i.imgur.com/ZbhzFqT.png" alt="DELICUTE Logo" class="h-8">
        <h1 class="text-3xl font-bold text-orange-600">Terms of Service</h1>
      </div>
      <p class="text-gray-700 mb-4">Welcome to DELICUTE. By using our services, you agree to the following terms and conditions:</p>
      <ul class="list-disc pl-6 text-gray-700">
        <li class="mb-2">You must provide accurate information during signup.</li>
        <li class="mb-2">Orders are subject to availability and confirmation.</li>
        <li class="mb-2">DELICUTE reserves the right to cancel orders due to unforeseen circumstances.</li>
        <li class="mb-2">All payments are processed securely through our payment gateway.</li>
        <li class="mb-2">We comply with the Information Technology Act, 2000 for data protection.</li>
      </ul>
      <p class="text-gray-700 mt-4">For any questions, contact us at <a href="/cdn-cgi/l/email-protection#b0838580809f8284b094959c9993858495de939f9d" class="text-orange-600 hover:underline"><span class="__cf_email__" data-cfemail="c1b2b4b1b1aeb3b581a5a4ada8a2b4b5a4efa2aeac">[email&#160;protected]</span></a>.</p>
      <a href="#" data-section="home" class="nav-link mt-4 inline-block text-orange-600 hover:underline">Back to Home</a>
    </div>
  </section>
  <section id="privacy" class="section hidden py-16">
    <div class="container mx-auto max-w-3xl">
      <div class="flex items-center space-x-2 mb-6">
        <img src="https://i.imgur.com/ZbhzFqT.png" alt="DELICUTE Logo" class="h-8">
        <h1 class="text-3xl font-bold text-orange-600">Privacy Policy</h1>
      </div>
      <p class="text-gray-700 mb-4">At DELICUTE, we value your privacy. This policy outlines how we handle your data:</p>
      <ul class="list-disc pl-6 text-gray-700">
        <li class="mb-2">We collect personal information (name, email, phone, address) to process orders.</li>
        <li class="mb-2">Your data is stored securely and not shared with third parties, except for payment processing.</li>
        <li class="mb-2">We use cookies to enhance your browsing experience.</li>
        <li class="mb-2">You can request deletion of your data by contacting us.</li>
        <li class="mb-2">We comply with the Information Technology Act, 2000.</li>
      </ul>
      <p class="text-gray-700 mt-4">For more details, email us at <a href="/cdn-cgi/l/email-protection#b0838580809f8284b094959c9993858495de939f9d" class="text-orange-600 hover:underline"><span class="__cf_email__" data-cfemail="c1b2b4b1b1aeb3b581a5a4ada8a2b4b5a4efa2aeac">[email&#160;protected]</span></a>.</p>
      <a href="#" data-section="home" class="nav-link mt-4 inline-block text-orange-600 hover:underline">Back to Home</a>
    </div>
  </section>
  <div id="toast" class="fixed top-4 right-4 bg-orange-600 text-white p-3 rounded-lg shadow-lg hidden z-50"></div>
  <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
  <script>
    const API_URL = window.location.hostname === 'localhost' ? 'http://localhost:3000/api/users' : 'https://delicute.onrender.com/api/users';
    const GOOGLE_CLIENT_ID = '1019406651586-rgl91utq3nn9ohudbrt15o74el8eq75j.apps.googleusercontent.com';
    let isLoggedIn = !!localStorage.getItem('jwtToken');
    const disposableDomains = [
      'tempmail.com', 'mailinator.com', 'guerrillamail.com', '10minutemail.com', 'yopmail.com',
      'getnada.com', 'dispostable.com', 'throwawaymail.com', 'temp-mail.org', 'fakemail.com'
    ];
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = `fixed top-4 right-4 p-3 rounded-lg shadow-lg z-50 text-white ${type === 'error' ? 'bg-red-500' : 'bg-orange-600'}`;
      toast.classList.remove('hidden');
      setTimeout(() => toast.classList.add('hidden'), 3000);
    }
    function decodeJWT(token) {
      try {
        const base64Url = token.split('.')[1];
        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => {
          return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
        return JSON.parse(jsonPayload);
      } catch (err) {
        console.error('Error decoding JWT:', err);
        return null;
      }
    }
    async function fetchData(endpoint, method = 'GET', data = null, includeToken = true) {
      const headers = {
        'Content-Type': 'application/json',
      };
      if (includeToken && localStorage.getItem('jwtToken')) {
        headers['Authorization'] = `Bearer ${localStorage.getItem('jwtToken')}`;
      }
      const config = {
        method,
        headers,
        credentials: 'include',
      };
      if (data) config.body = JSON.stringify(data);
      try {
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 10000);
        config.signal = controller.signal;
        const response = await fetch(`${API_URL}${endpoint}`, config);
        clearTimeout(timeoutId);
        if (!response.ok) {
          const errorData = await response.json().catch(() => ({}));
          console.error('Fetch response:', response.status, errorData);
          throw new Error(errorData.message || `HTTP ${response.status}`);
        }
        return await response.json();
      } catch (error) {
        console.error('Fetch error:', error);
        if (error.name === 'AbortError') {
          showToast('Request timed out. Please try again.', 'error');
        } else {
          showToast(`Error: ${error.message}`, 'error');
        }
        throw error;
      }
    }
    function initializeGoogleSignIn() {
      google.accounts.id.initialize({
        client_id: GOOGLE_CLIENT_ID,
        callback: handleGoogleLogin,
        auto_select: false,
        context: 'signin',
        ux_mode: 'popup',
      });
      google.accounts.id.renderButton(
        document.getElementById('googleSignInButton'),
        {
          theme: 'outline',
          size: 'large',
          text: 'continue_with',
          shape: 'rectangular',
          logo_alignment: 'left',
        }
      );
    }
    async function handleGoogleLogin(response) {
      try {
        if (!response.credential) {
          throw new Error('No credential received from Google');
        }
        const res = await fetchData('/google', 'POST', { id_token: response.credential }, false);
        if (res && res.token) {
          localStorage.setItem('jwtToken', res.token);
          isLoggedIn = true;
          updateNav();
          showToast('Google login successful!');
          const decodedToken = decodeJWT(res.token);
          if (decodedToken && decodedToken.role === 'admin') {
            window.location.href = '/admin.html';
          } else {
            window.location.href = '/user.html';
          }
        } else {
          throw new Error('No token received from backend');
        }
      } catch (error) {
        console.error('Google login error:', error);
        showToast(`Google login failed: ${error.message}`, 'error');
      }
    }
    const sections = document.querySelectorAll('.section');
    const navLinks = document.querySelectorAll('.nav-link');
    function showSection(sectionId) {
      sections.forEach(section => section.classList.add('hidden'));
      document.getElementById(sectionId).classList.remove('hidden');
      updateMenuVisibility();
      if (sectionId !== 'login') {
        document.getElementById('mobileMenu').classList.add('hidden');
      }
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    navLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const sectionId = link.getAttribute('data-section');
        showSection(sectionId);
      });
    });
    const menuToggle = document.getElementById('menuToggle');
    const mobileMenu = document.getElementById('mobileMenu');
    menuToggle.addEventListener('click', () => {
      mobileMenu.classList.toggle('hidden');
    });
    const loginTab = document.getElementById('loginTab');
    const signupTab = document.getElementById('signupTab');
    const loginForm = document.getElementById('loginForm');
    const signupForm = document.getElementById('signupForm');
    loginTab.addEventListener('click', () => {
      loginForm.classList.remove('hidden');
      signupForm.classList.add('hidden');
      loginTab.classList.add('border-orange-600', 'text-orange-600');
      signupTab.classList.remove('border-orange-600', 'text-orange-600');
      signupTab.classList.add('text-gray-600');
      resetSignupForm();
    });
    signupTab.addEventListener('click', () => {
      signupForm.classList.remove('hidden');
      loginForm.classList.add('hidden');
      signupTab.classList.add('border-orange-600', 'text-orange-600');
      loginTab.classList.remove('border-orange-600', 'text-orange-600');
      loginTab.classList.add('text-gray-600');
    });
    function isDisposableEmail(email) {
      const domain = email.split('@')[1]?.toLowerCase();
      return disposableDomains.includes(domain);
    }
    function validateEmailFormat(email) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }
    function validateSignupForm() {
      let isValid = true;
      const name = document.getElementById('signupName').value.trim();
      const nameError = document.getElementById('signupNameError');
      if (name.length < 3) {
        nameError.classList.remove('hidden');
        isValid = false;
      } else {
        nameError.classList.add('hidden');
      }
      const email = document.getElementById('signupEmail').value.trim();
      const emailError = document.getElementById('signupEmailError');
      if (!validateEmailFormat(email) || isDisposableEmail(email)) {
        emailError.classList.remove('hidden');
        isValid = false;
      } else {
        emailError.classList.add('hidden');
      }
      const phone = document.getElementById('signupPhone').value.trim();
      const phoneError = document.getElementById('signupPhoneError');
      const phoneRegex = /^\d{10}$/;
      if (!phoneRegex.test(phone)) {
        phoneError.classList.remove('hidden');
        isValid = false;
      } else {
        phoneError.classList.add('hidden');
      }
      const password = document.getElementById('signupPassword').value;
      const passwordError = document.getElementById('signupPasswordError');
      if (password.length < 8) {
        passwordError.classList.remove('hidden');
        isValid = false;
      } else {
        passwordError.classList.add('hidden');
      }
      const address = document.getElementById('signupAddress').value.trim();
      const addressError = document.getElementById('signupAddressError');
      if (address.length === 0) {
        addressError.classList.remove('hidden');
        isValid = false;
      } else {
        addressError.classList.add('hidden');
      }
      const otp = document.getElementById('signupOtp').value.trim();
      const otpError = document.getElementById('signupOtpError');
      const otpRegex = /^\d{6}$/;
      if (!otpRegex.test(otp)) {
        otpError.classList.remove('hidden');
        isValid = false;
      } else {
        otpError.classList.add('hidden');
      }
      return isValid;
    }
    function resetSignupForm() {
      signupForm.reset();
      document.querySelectorAll('#signupForm .text-red-500').forEach(error => error.classList.add('hidden'));
      stopLoadingState();
      resetOtpButton();
    }
    function startLoadingState() {
      const signupButton = document.getElementById('signupButton');
      const signupButtonText = document.getElementById('signupButtonText');
      const signupLoadingSpinner = document.getElementById('signupLoadingSpinner');
      signupButton.disabled = true;
      signupButtonText.textContent = 'Signing Up...';
      signupLoadingSpinner.classList.remove('hidden');
    }
    function stopLoadingState() {
      const signupButton = document.getElementById('signupButton');
      const signupButtonText = document.getElementById('signupButtonText');
      const signupLoadingSpinner = document.getElementById('signupLoadingSpinner');
      signupButton.disabled = false;
      signupButtonText.textContent = 'Sign Up';
      signupLoadingSpinner.classList.add('hidden');
    }
    function startOtpLoading() {
      const sendOtpButton = document.getElementById('sendOtpButton');
      const sendOtpButtonText = document.getElementById('sendOtpButtonText');
      const otpLoadingSpinner = document.getElementById('otpLoadingSpinner');
      sendOtpButton.disabled = true;
      sendOtpButtonText.textContent = 'Sending...';
      otpLoadingSpinner.classList.remove('hidden');
    }
    function stopOtpLoading() {
      const sendOtpButton = document.getElementById('sendOtpButton');
      const sendOtpButtonText = document.getElementById('sendOtpButtonText');
      const otpLoadingSpinner = document.getElementById('otpLoadingSpinner');
      sendOtpButton.disabled = false;
      sendOtpButtonText.textContent = 'Send OTP';
      otpLoadingSpinner.classList.add('hidden');
    }
    function startOtpTimer() {
      let timeLeft = 30;
      const sendOtpButton = document.getElementById('sendOtpButton');
      const sendOtpButtonText = document.getElementById('sendOtpButtonText');
      const otpTimer = document.getElementById('otpTimer');
      const otpTimerCount = document.getElementById('otpTimerCount');
      sendOtpButton.disabled = true;
      sendOtpButtonText.textContent = 'Resend OTP';
      otpTimer.classList.remove('hidden');
      otpTimerCount.textContent = timeLeft;
      if (window.otpTimerInterval) {
        clearInterval(window.otpTimerInterval);
      }
      window.otpTimerInterval = setInterval(() => {
        timeLeft--;
        otpTimerCount.textContent = timeLeft;
        if (timeLeft <= 0) {
          clearInterval(window.otpTimerInterval);
          sendOtpButton.disabled = false;
          otpTimer.classList.add('hidden');
          otpTimerCount.textContent = '30';
        }
      }, 1000);
    }
    function resetOtpButton() {
      const sendOtpButton = document.getElementById('sendOtpButton');
      const sendOtpButtonText = document.getElementById('sendOtpButtonText');
      const otpTimer = document.getElementById('otpTimer');
      const otpLoadingSpinner = document.getElementById('otpLoadingSpinner');
      sendOtpButton.disabled = false;
      sendOtpButtonText.textContent = 'Send OTP';
      otpTimer.classList.add('hidden');
      otpLoadingSpinner.classList.add('hidden');
      if (window.otpTimerInterval) {
        clearInterval(window.otpTimerInterval);
      }
    }
    document.getElementById('sendOtpButton').addEventListener('click', async () => {
      const email = document.getElementById('signupEmail').value.trim();
      const emailError = document.getElementById('signupEmailError');
      if (!email) {
        showToast('Please enter your email address.', 'error');
        return;
      }
      if (!validateEmailFormat(email) || isDisposableEmail(email)) {
        emailError.classList.remove('hidden');
        showToast('Please provide a valid email address. Disposable emails are not allowed.', 'error');
        return;
      }
      emailError.classList.add('hidden');
      startOtpLoading();
      try {
        const otpData = await fetchData('/request-otp', 'POST', { email }, false);
        stopOtpLoading();
        if (otpData) {
          showToast(`A 6-digit OTP has been sent to ${email}. Please check your inbox or spam folder.`);
          startOtpTimer();
        }
      } catch (error) {
        stopOtpLoading();
        showToast(`Failed to send OTP: ${error.message}`, 'error');
      }
    });
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      try {
        const data = await fetchData('/login', 'POST', { email, password }, false);
        if (data && data.token) {
          localStorage.setItem('jwtToken', data.token);
          isLoggedIn = true;
          updateNav();
          showToast('Login successful!');
          const decodedToken = decodeJWT(data.token);
          if (decodedToken && decodedToken.role === 'admin') {
            window.location.href = '/admin.html';
          } else {
            window.location.href = '/user.html';
          }
        } else {
          showToast('Login failed. Please check your credentials.', 'error');
        }
      } catch (error) {
        showToast(`Login error: ${error.message}`, 'error');
      }
    });
    signupForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!validateSignupForm()) {
        showToast('Please fix the errors in the form.', 'error');
        return;
      }
      const name = document.getElementById('signupName').value;
      const email = document.getElementById('signupEmail').value;
      const phone = document.getElementById('signupPhone').value;
      const password = document.getElementById('signupPassword').value;
      const address = document.getElementById('signupAddress').value;
      const otp = document.getElementById('signupOtp').value;
      startLoadingState();
      try {
        const signupData = await fetchData('/signup', 'POST', { name, email, phone, password, address, otp }, false);
        if (signupData && signupData.token) {
          localStorage.setItem('jwtToken', signupData.token);
          isLoggedIn = true;
          updateNav();
          showToast('Signup successful!');
          window.location.href = '/user.html';
        } else {
          showToast('Signup failed. Please try again.', 'error');
        }
      } catch (error) {
        showToast(`Signup error: ${error.message}`, 'error');
      }
      stopLoadingState();
    });
    const forgotPasswordLink = document.getElementById('forgotPassword');
    const forgotPasswordModal = document.getElementById('forgotPasswordModal');
    const closeModal = document.getElementById('closeModal');
    const sendOtp = document.getElementById('sendOtp');
    const resetPassword = document.getElementById('resetPassword');
    const emailStep = document.getElementById('emailStep');
    const otpStep = document.getElementById('otpStep');
    const resendResetOtp = document.getElementById('resendResetOtp');
    forgotPasswordLink.addEventListener('click', (e) => {
      e.preventDefault();
      forgotPasswordModal.classList.remove('hidden');
    });
    closeModal.addEventListener('click', () => {
      forgotPasswordModal.classList.add('hidden');
      emailStep.classList.remove('hidden');
      otpStep.classList.add('hidden');
      document.getElementById('resetEmail').value = '';
      document.getElementById('otpInput').value = '';
      document.getElementById('newPassword').value = '';
    });
    sendOtp.addEventListener('click', async () => {
      const email = document.getElementById('resetEmail').value;
      try {
        const data = await fetchData('/request-otp', 'POST', { email }, false);
        if (data) {
          showToast('OTP sent to your email. Check your inbox or spam folder.');
          emailStep.classList.add('hidden');
          otpStep.classList.remove('hidden');
          startResendTimer('resendResetOtp', 'resendResetTimer');
        }
      } catch (error) {
        showToast(`Failed to send OTP: ${error.message}`, 'error');
      }
    });
    resendResetOtp.addEventListener('click', async () => {
      const email = document.getElementById('resetEmail').value;
      try {
        const data = await fetchData('/request-otp', 'POST', { email }, false);
        if (data) {
          showToast('OTP resent to your email. Check your inbox or spam folder.');
          startResendTimer('resendResetOtp', 'resendResetTimer');
        }
      } catch (error) {
        showToast(`Failed to resend OTP: ${error.message}`, 'error');
      }
    });
    resetPassword.addEventListener('click', async () => {
      const email = document.getElementById('resetEmail').value;
      const otp = document.getElementById('otpInput').value;
      const newPassword = document.getElementById('newPassword').value;
      try {
        const data = await fetchData('/reset-password', 'POST', { email, otp, newPassword }, false);
        if (data) {
          showToast('Password reset successful!');
          forgotPasswordModal.classList.add('hidden');
          emailStep.classList.remove('hidden');
          otpStep.classList.add('hidden');
          document.getElementById('resetEmail').value = '';
          document.getElementById('otpInput').value = '';
          document.getElementById('newPassword').value = '';
        }
      } catch (error) {
        showToast(`Password reset failed: ${error.message}`, 'error');
      }
    });
    function startResendTimer(buttonId, timerId) {
      let timeLeft = 30;
      const button = document.getElementById(buttonId);
      const timerSpan = document.getElementById(timerId);
      button.disabled = true;
      timerSpan.textContent = timeLeft;
      const timer = setInterval(() => {
        timeLeft--;
        timerSpan.textContent = timeLeft;
        if (timeLeft <= 0) {
          clearInterval(timer);
          button.disabled = false;
          timerSpan.textContent = '30';
        }
      }, 1000);
    }
    function updateMenuVisibility() {
      const menuSection = document.getElementById('menuSection');
      const loginPrompt = document.getElementById('loginPrompt');
      if (isLoggedIn) {
        menuSection.classList.remove('hidden');
        loginPrompt.classList.add('hidden');
        loadMenu();
      } else {
        menuSection.classList.add('hidden');
        loginPrompt.classList.remove('hidden');
      }
    }
    function updateNav() {
      const loginNav = document.getElementById('loginNav');
      const mobileLoginNav = document.getElementById('mobileLoginNav');
      if (isLoggedIn) {
        loginNav.textContent = 'Logout';
        mobileLoginNav.textContent = 'Logout';
        loginNav.onclick = logout;
        mobileLoginNav.onclick = logout;
      } else {
        loginNav.textContent = 'Login';
        mobileLoginNav.textContent = 'Login';
        loginNav.onclick = (e) => {
          e.preventDefault();
          showSection('login');
        };
        mobileLoginNav.onclick = (e) => {
          e.preventDefault();
          showSection('login');
        };
      }
    }
    function logout(e) {
      e.preventDefault();
      localStorage.removeItem('jwtToken');
      isLoggedIn = false;
      updateNav();
      showSection('login');
      showToast('Logged out!');
    }
    async function loadMenu(category = '') {
      try {
        const data = await fetchData(`/menu${category ? `?category=${category}` : ''}`);
        if (!data) return;
        const menuContainer = document.getElementById('menuItems');
        menuContainer.innerHTML = data
          .map(item => `
            <div class="bg-white rounded-lg shadow-lg p-4 hover:shadow-xl transition">
              <img src="${item.image}" alt="${item.name}" class="w-full h-48 object-cover rounded-lg">
              <h3 class="text-xl font-semibold mt-4">${item.name}</h3>
              <p class="text-gray-600">₹${item.price}</p>
              <button class="add-to-cart mt-4 bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700" data-item-id="${item.id}" data-item-name="${item.name}" data-item-price="${item.price}">Add to Cart</button>
            </div>
          `).join('');
      } catch (error) {
        showToast(`Failed to load menu: ${error.message}`, 'error');
      }
    }
    const orderNow = document.getElementById('orderNow');
    orderNow.addEventListener('click', () => {
      if (!isLoggedIn) {
        showToast('Please login to place an order');
        showSection('login');
      } else {
                showToast('Redirecting to order page...');
        showSection('home');
      }
    });

    document.addEventListener('click', async (e) => {
      if (e.target.classList.contains('add-to-cart')) {
        if (!isLoggedIn) {
          showToast('Please login to add items to cart', 'error');
          showSection('login');
          return;
        }
        const item = {
          id: e.target.dataset.itemId,
          name: e.target.dataset.itemName,
          price: e.target.dataset.itemPrice,
        };
        try {
          await fetchData('/cart/add', 'POST', { item });
          showToast(`${item.name} added to cart!`);
        } catch (error) {
          showToast(`Failed to add to cart: ${error.message}`, 'error');
        }
      }
    });

    const searchDishes = document.getElementById('searchDishes');
    searchDishes.addEventListener('input', async () => {
      const searchTerm = searchDishes.value.trim();
      try {
        const data = await fetchData(`/menu?search=${encodeURIComponent(searchTerm)}`);
        const menuContainer = document.getElementById('menuItems');
        menuContainer.innerHTML = data
          .map(item => `
            <div class="bg-white rounded-lg shadow-lg p-4 hover:shadow-xl transition">
              <img src="${item.image}" alt="${item.name}" class="w-full h-48 object-cover rounded-lg">
              <h3 class="text-xl font-semibold mt-4">${item.name}</h3>
              <p class="text-gray-600">₹${item.price}</p>
              <button class="add-to-cart mt-4 bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700" data-item-id="${item.id}" data-item-name="${item.name}" data-item-price="${item.price}">Add to Cart</button>
            </div>
          `).join('');
      } catch (error) {
        showToast(`Search failed: ${error.message}`, 'error');
      }
    });

    const filterButtons = document.querySelectorAll('.filter-btn');
    filterButtons.forEach(button => {
      button.addEventListener('click', () => {
        const category = button.dataset.category;
        loadMenu(category);
      });
    });

    // Initialize
    updateNav();
    showSection('login');
    initializeGoogleSignIn();

    // Ensure menu visibility on page load
    updateMenuVisibility();
  </script>
</body>
</html>