<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delicute - User Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('https://images.unsplash.com/photo-1515003197210-e0cd71810b5f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80') no-repeat center center fixed;
            background-size: cover;
            color: #1f2937;
            transition: all 0.3s ease;
            min-height: 100vh;
        }
        body.dark-mode {
            background: linear-gradient(135deg, rgba(31, 41, 55, 0.9), rgba(55, 65, 81, 0.9)), url('https://images.unsplash.com/photo-1515003197210-e0cd71810b5f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80') no-repeat center center fixed;
            color: #e5e7eb;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
            animation: fadeIn 0.3s ease;
        }
        .modal-content {
            background: #ffffff;
            padding: 24px;
            border-radius: 16px;
            max-width: 90%;
            width: 600px;
            position: relative;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            animation: slideIn 0.3s ease-out;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(240, 240, 240, 0.95));
        }
        body.dark-mode .modal-content {
            background: linear-gradient(135deg, rgba(31, 41, 55, 0.95), rgba(55, 65, 81, 0.95));
        }
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .close-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            font-size: 28px;
            cursor: pointer;
            color: #374151;
            transition: color 0.2s;
        }
        body.dark-mode .close-enable {
            color: #e5e7eb;
        }
        .close-btn:hover {
            color: #ff6f61;
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 12px;
            color: #ffffff;
            z-index: 2000;
            display: none;
            min-width: 250px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.3s ease-in;
        }
        .toast.success {
            background-color: #34c759;
        }
        .toast.error {
            background-color: #ff3b30;
        }
        .btn-primary {
            background: linear-gradient(90deg, #ff6f61, #ff8a75);
            color: #ffffff;
            padding: 12px 24px;
            border-radius: 9999px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: 600;
        }
        .btn-primary:hover {
            background: linear-gradient(90deg, #ff8a75, #ff6f61);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }
        .btn-primary:disabled {
            background: #d1d5db;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .btn-secondary {
            background: linear-gradient(90deg, #6b7280, #4b5563);
            color: #ffffff;
            padding: 8px 16px;
            border-radius: 999(Frame - 1)px;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        .btn-secondary:hover {
            background: linear-gradient(90deg, #4b5563, #6b7280);
            transform: translateY(-2px);
        }
        .input-field {
            transition: all 0.3s ease;
            border-radius: 8px;
            border: 1px solid #d1d5db;
            background: #ffffff;
            padding: 12px;
            color: #1f2937;
        }
        body.dark-mode .input-field {
            background: #374151;
            border-color: #4b5563;
            color: #e5e7eb;
        }
        .input-field:focus {
            border-color: #ff6f61;
            box-shadow: 0 0 0 3px rgba(255, 111, 97, 0.2);
            outline: none;
        }
        .navbar-menu {
            transition: max-height 0.3s ease-in-out;
            max-height: 0;
            overflow: hidden;
            background: #ffffff;
        }
        body.dark-mode .navbar-menu {
            background: #1f2937;
        }
        .navbar-menu.active {
            max-height: 500px;
        }
        .section {
            display: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 24px;
            backdrop-filter: blur(8px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        body.dark-mode .section {
            background: rgba(55, 65, 81, 0.3);
        }
        .section.active {
            display: block;
        }
        .menu-card, .coupon-card, .address-card, .cart-card {
            transition: all 0.3s ease;
            background: #ffffff;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        body.dark-mode .menu-card, body.dark-mode .coupon-card, body.dark-mode .address-card, body.dark-mode .cart-card {
            background: #1f2937;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        .menu-card:hover, .coupon-card:hover, .address-card:hover, .cart-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.25);
        }
        .coupon-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        .menu-item-card {
            background: #ffffff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .menu-item-card:hover {
            transform: translateY(-4px);
        }
        .menu-item-card img {
            width: 100%;
            height: 140px;
            object-fit: cover;
            border-bottom: 3px solid #ff6f61;
            padding: 8px;
            border-radius: 12px 12px 0 0;
        }
        .category-tab {
            background: #ff6f61;
            color: #ffffff;
            padding: 8px 16px;
            border-radius: 20px;
            margin-right: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .category-tab:hover {
            background: #ff8a75;
        }
        .category-tab.active {
            background: #ff8a75;
            font-weight: 600;
        }
        .coupon-card {
            border: 2px solid #ff6f61;
        }
        body.dark-mode .coupon-card {
            border-color: #ff8a75;
        }
        .dropdown {
            position: relative;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background: #ffffff;
            min-width: 220px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            z-index: 1;
            border-radius: 12px;
            overflow: hidden;
        }
        body.dark-mode .dropdown-content {
            background: #1f2937;
        }
        .dropdown:hover .dropdown-content {
            display: block;
        }
        .dropdown-content a, .dropdown-content button {
            color: #374151;
            padding: 14px 18px;
            text-decoration: none;
            display: block;
            transition: all 0.2s ease;
            font-weight: 500;
        }
        body.dark-mode .dropdown-content a, body.dark-mode .dropdown-content button {
            color: #e5e7eb;
        }
        .dropdown-content a:hover, .dropdown-content button:hover {
            background: #f3f4f6;
        }
        body.dark-mode .dropdown-content a:hover, body.dark-mode .dropdown-content button:hover {
            background: #4b5563;
        }
        .rating-stars {
            color: #ff6f61;
            font-size: 18px;
        }
        .welcome-message {
            background: linear-gradient(90deg, #ff6f61, #ff8a75);
            color: #ffffff;
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            margin-bottom: 32px;
            font-size: 1.5rem;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        .profile-card {
            background: #ffffff;
            border-radius: 24px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
            padding: 40px;
            transition: all 0.3s ease;
        }
        body.dark-mode .profile-card {
            background: #1f2937;
        }
        .profile-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        }
        .profile-image-container {
            position: relative;
            display: inline-block;
        }
        .profile-image-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 111, 97, 0.3);
            border-radius: 50%;
            opacity: 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        .profile-image-container:hover .profile-image-overlay {
            opacity: 1;
        }
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        .address-card {
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background: #ffffff;
            border: 2px solid #ff6f61;
        }
        body.dark-mode .address-card {
            background: #1f2937;
            border-color: #ff8a75;
        }
        .address-card p {
            margin: 0;
            line-height: 1.6;
        }
        .address-card .address-header {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
        }
        body.dark-mode .address-card .address-header {
            color: #e5e7eb;
        }
        .address-card .address-details {
            color: #4b5563;
            font-size: 0.95rem;
        }
        body.dark-mode .address-card .address-details {
            color: #d1d5db;
        }
        .address-card .address-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }
        .required::after {
            content: '*';
            color: #ff3b30;
            margin-left: 4px;
        }
        .search-container {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
            background: rgba(255, 255, 255, 0.9);
            padding: 12px 20px;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }
        body.dark-mode .search-container {
            background: rgba(55, 65, 81, 0.9);
        }
        .search-container input, .search-container select {
            flex: 1;
            padding: 10px 16px;
            border: 1px solid #d1d5db;
            border-radius: 25px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        body.dark-mode .search-container input, body.dark-mode .search-container select {
            background: #374151;
            border-color: #4b5563;
            color: #e5e7eb;
        }
        .search-container input:focus, .search-container select:focus {
            border-color: #ff6f61;
            box-shadow: 0 0 0 3px rgba(255, 111, 97, 0.2);
            outline: none;
        }
        .section-title {
            position: relative;
            display: inline-block;
            padding-bottom: 10px;
            margin-bottom: 32px;
            color: #ffffff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 50%;
            height: 4px;
            background: linear-gradient(90deg, #ff6f61, #ff8a75);
            border-radius: 2px;
        }
        .menu-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 24px;
            border-radius: 20px;
            backdrop-filter: blur(8px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        body.dark-mode .menu-section {
            background: rgba(55, 65, 81, 0.3);
        }
        @media (max-width: 640px) {
            .modal-content {
                padding: 16px;
                width: 95%;
            }
            .toast {
                top: 12px;
                right: 12px;
                padding: 12px;
                min-width: 200px;
            }
            .navbar-menu {
                max-height: 0;
                overflow: hidden;
            }
            .navbar-menu.active {
                max-height: 600px;
            }
            .dropdown-content {
                width: 100%;
                right: 0;
            }
            .coupon-card img {
                height: 180px;
            }
            .menu-item-card img {
                height: 120px;
            }
            .profile-card {
                padding: 24px;
            }
            .welcome-message {
                font-size: 1.25rem;
                padding: 16px;
            }
            .address-card {
                padding: 16px;
            }
            .address-card .address-header {
                font-size: 1.1rem;
            }
            .search-container {
                flex-direction: column;
                gap: 12px;
                padding: 12px;
            }
            .search-container input, .search-container select {
                width: 100%;
            }
        }
        .item-name, .coupon-code {
            color: #1f2937 !important;
        }
        body.dark-mode .item-name, body.dark-mode .coupon-code {
            color: #ffffff !important;
        }
    </style>
</head>
<body>
    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Navbar -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center space-x-4">
                    <img src="https://i.postimg.cc/zv19J0xv/Zbhz-Fq-T-Imgur.jpg" alt="Delicute Logo" class="h-12">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800 sm:text-3xl">DELICUTE</h1>
                        <p class="text-sm text-gray-500 sm:text-base">Every bite tells a story</p>
                    </div>
                </div>
                <div class="flex items-center space-x-6">
                    <div class="dropdown hidden sm:block">
                        <button class="flex items-center space-x-2 text-gray-600 hover:text-gray-900">
                            <img id="headerProfileImage" src="https://via.placeholder.com/100" alt="Profile" class="h-12 w-12 rounded-full object-cover border-2 border-ff6f61">
                            <span id="headerUserName" class="font-semibold"></span>
                        </button>
                        <div class="dropdown-content">
                            <a href="#" onclick="showSection('home')"><i class="fas fa-home mr-2"></i>Home</a>
                            <a href="#" onclick="showSection('cart')"><i class="fas fa-shopping-cart mr-2"></i>Cart</a>
                            <a href="#" onclick="showSection('orders')"><i class="fas fa-shopping-cart mr-2"></i>Orders</a>
                            <a href="#" onclick="showSection('favorites')"><i class="fas fa-heart mr-2"></i>Favorites</a>
                            <a href="#" onclick="showSection('orderHistory')"><i class="fas fa-history mr-2"></i>Order History</a>
                            <a href="#" onclick="showSection('addresses')"><i class="fas fa-map-marker-alt mr-2"></i>Addresses</a>
                            <a href="#" onclick="showSection('profile')"><i class="fas fa-user mr-2"></i>Profile</a>
                            <a href="#" onclick="showSection('contact')"><i class="fas fa-envelope mr-2"></i>Contact Us</a>
                            <button onclick="toggleDarkMode()"><i class="fas fa-moon mr-2"></i>Toggle Dark Mode</button>
                            <button onclick="logout()"><i class="fas fa-sign-out-alt mr-2"></i>Logout</button>
                        </div>
                    </div>
                    <button id="menuToggle" class="sm:hidden text-gray-600 hover:text-gray-900 focus:outline-none">
                        <svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <div id="navbarMenu" class="navbar-menu sm:hidden">
                <div class="flex flex-col space-y-3 px-4 pb-4">
                    <a href="#" onclick="showSection('home')" class="text-gray-600 hover:text-gray-900 text-base"><i class="fas fa-home mr-2"></i>Home</a>
                    <a href="#" onclick="showSection('cart')" class="text-gray-600 hover:text-gray-900 text-base"><i class="fas fa-shopping-cart mr-2"></i>Cart</a>
                    <a href="#" onclick="showSection('orders')" class="text-gray-600 hover:text-gray-900 text-base"><i class="fas fa-shopping-cart mr-2"></i>Orders</a>
                    <a href="#" onclick="showSection('favorites')" class="text-gray-600 hover:text-gray-900 text-base"><i class="fas fa-heart mr-2"></i>Favorites</a>
                    <a href="#" onclick="showSection('orderHistory')" class="text-gray-600 hover:text-gray-900 text-base"><i class="fas fa-history mr-2"></i>Order History</a>
                    <a href="#" onclick="showSection('addresses')" class="text-gray-600 hover:text-gray-900 text-base"><i class="fas fa-map-marker-alt mr-2"></i>Addresses</a>
                    <a href="#" onclick="showSection('profile')" class="text-gray-600 hover:text-gray-900 text-base"><i class="fas fa-user mr-2"></i>Profile</a>
                    <a href="#" onclick="showSection('contact')" class="text-gray-600 hover:text-gray-900 text-base"><i class="fas fa-envelope mr-2"></i>Contact Us</a>
                    <button onclick="toggleDarkMode()" class="text-gray-600 hover:text-gray-900 text-base text-left"><i class="fas fa-moon mr-2"></i>Toggle Dark Mode</button>
                    <button onclick="logout()" class="text-gray-600 hover:text-gray-900 text-base text-left"><i class="fas fa-sign-out-alt mr-2"></i>Logout</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Coupon Modal -->
    <div id="couponModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('couponModal')">×</span>
            <h2 class="text-2xl font-bold text-gray-800 text-center mb-6">Apply Coupon</h2>
            <div>
                <label for="couponCode" class="block text-gray-700 font-medium mb-2 text-base">Enter Coupon Code</label>
                <input type="text" id="couponCode" class="input-field w-full p-3 text-base" placeholder="Enter coupon code">
            </div>
            <div class="mt-6">
                <button onclick="applyCoupon()" class="btn-primary w-full">Apply Coupon</button>
            </div>
        </div>
    </div>

    <!-- Rate Item Modal -->
    <div id="rateModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('rateModal')">×</span>
            <h2 class="text-2xl font-bold text-gray-800 text-center mb-6">Rate Item</h2>
            <div>
                <label for="rating" class="block text-gray-700 font-medium mb-2 text-base">Rating (1-5)</label>
                <input type="number" id="rating" min="1" max="5" class="input-field w-full p-3 text-base" placeholder="Enter rating">
                <label for="review" class="block text-gray-700 font-medium mb-4 mt-4 text-base">Review (Optional)</label>
                <textarea id="review" class="input-field w-full p-3 text-base" rows="4" placeholder="Write your review"></textarea>
            </div>
            <div class="mt-6">
                <button onclick="submitRating()" class="btn-primary w-full">Submit Rating</button>
            </div>
        </div>
    </div>

    <!-- Order Confirmation Modal -->
    <div id="orderConfirmationModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('orderConfirmationModal')">×</span>
            <h2 class="text-2xl font-bold text-gray-800 text-center mb-6">Order Details</h2>
            <div id="orderConfirmationDetails" class="text-center text-base text-gray-600"></div>
            <div class="mt-6">
                <button onclick="closeModal('orderConfirmationModal')" class="btn-primary w-full">Close</button>
            </div>
        </div>
    </div>

    <!-- Cancel Order Modal -->
    <div id="cancelOrderModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('cancelOrderModal')">×</span>
            <h2 class="text-2xl font-bold text-gray-800 text-center mb-6">Cancel Order</h2>
            <div>
                <label for="cancelReason" class="block text-gray-700 font-medium mb-2 text-base">Reason for Cancellation</label>
                <textarea id="cancelReason" class="input-field w-full p-3 text-base" rows="4" placeholder="Enter reason for cancellation"></textarea>
            </div>
            <div class="mt-6 flex space-x-4">
                <button onclick="submitCancelOrder()" class="btn-primary w-full">Submit</button>
                <button onclick="closeModal('cancelOrderModal')" class="btn-secondary w-full">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Address Modal -->
    <div id="addressModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('addressModal')">×</span>
            <h2 id="addressModalTitle" class="text-2xl font-bold text-gray-800 text-center mb-6">Add Address</h2>
            <div>
                <label for="fullName" class="block text-gray-700 font-medium mb-2 text-base required">Full Name</label>
                <input type="text" id="fullName" class="input-field w-full p-3 text-base" placeholder="Enter full name">
                <label for="mobileNumber" class="block text-gray-700 font-medium mb-2 mt-4 text-base required">Mobile Number</label>
                <input type="tel" id="mobileNumber" class="input-field w-full p-3 text-base" placeholder="Enter mobile number">
                <label for="houseFlatNo" class="block text-gray-700 font-medium mb-2 mt-4 text-base required">House/Flat No</label>
                <input type="text" id="houseFlatNo" class="input-field w-full p-3 text-base" placeholder="Enter house/flat no">
                <label for="floorNo" class="block text-gray-700 font-medium mb-2 mt-4 text-base required">Floor No</label>
                <input type="text" id="floorNo" class="input-field w-full p-3 text-base" placeholder="Enter floor no">
                <label for="address" class="block text-gray-700 font-medium mb-2 mt-4 text-base required">Address</label>
                <input type="text" id="address" class="input-field w-full p-3 text-base" placeholder="Enter address">
                <label for="landmark" class="block text-gray-700 font-medium mb-2 mt-4 text-base required">Landmark</label>
                <input type="text" id="landmark" class="input-field w-full p-3 text-base" placeholder="Enter landmark">
            </div>
            <div class="mt-6 flex space-x-4">
                <button id="saveAddressBtn" onclick="saveAddress()" class="btn-primary w-full">Save Address</button>
                <button onclick="closeModal('addressModal')" class="btn-secondary w-full">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Contact Us Modal -->
    <div id="contactModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('contactModal')">×</span>
            <h2 class="text-2xl font-bold text-gray-800 text-center mb-6">Contact Us</h2>
            <p class="text-gray-600 text-base mb-4">For support, contact us at <a href="mailto:support@delicute.com" class="text-blue-500 hover:underline">support@delicute.com</a> or call <a href="tel:+919652296548" class="text-blue-500 hover:underline">+91 9652296548</a>.</p>
            <div>
                <label for="contactSubject" class="block text-gray-700 font-medium mb-2 text-base required">Subject</label>
                <input type="text" id="contactSubject" class="input-field w-full p-3 text-base" placeholder="Enter subject">
                <label for="contactMessage" class="block text-gray-700 font-medium mb-2 mt-4 text-base required">Your Message</label>
                <textarea id="contactMessage" class="input-field w-full p-3 text-base" rows="4" placeholder="Enter your message"></textarea>
            </div>
            <div class="mt-6">
                <button onclick="submitContactMessage()" class="btn-primary w-full"><i class="fas fa-paper-plane mr-2"></i>Send Message</button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div id="mainContent" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <!-- Home Section -->
        <section id="homeSection" class="section active">
            <div id="welcomeMessage" class="welcome-message"></div>
            <h2 class="text-3xl font-bold text-white text-center mb-8 sm:text-4xl section-title">Available Coupons</h2>
            <div id="couponItems" class="grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3 mb-12"></div>
            <h2 class="text-3xl font-bold text-white text-center mb-8 sm:text-4xl section-title">Explore Our Menu</h2>
            <div class="menu-section">
                <div class="search-container">
                    <input type="text" id="menuSearch" placeholder="Search menu items..." oninput="filterMenuItems()">
                    <select id="categoryFilter" onchange="filterMenuItems()">
                        <option value="">All Categories</option>
                    </select>
                </div>
                <div id="menuItems" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-6 mt-8"></div>
            </div>
        </section>

        <!-- Cart Section -->
        <section id="cartSection" class="section">
            <h2 class="text-3xl font-bold text-white text-center mb-8 sm:text-4xl section-title">Your Cart</h2>
            <p class="text-center text-lg text-white mb-6"><strong>Note:</strong> All UPI apps will be available soon! Please use Cash on Delivery (COD) until then. Thank you!</p>
            <div class="mb-6">
                <label for="cartAddress" class="block text-white font-medium mb-2 text-base">Select Delivery Address</label>
                <select id="cartAddress" class="input-field w-full p-3 text-base" onchange="updateCartTotal()">
                    <option value="">Select an address</option>
                </select>
            </div>
            <div id="cartItems" class="grid grid-cols-1 gap-8"></div>
            <div id="cartSummary" class="mt-6 text-right text-white">
                <p class="text-lg font-semibold">Total: ₹<span id="cartTotal">0.00</span></p>
                <button id="placeOrderBtn" onclick="placeOrder()" class="btn-primary mt-4">Place Order (COD)</button>
            </div>
        </section>

        <!-- Orders Section -->
        <section id="ordersSection" class="section">
            <h2 class="text-3xl font-bold text-white text-center mb-8 sm:text-4xl section-title">Your Orders</h2>
            <div id="orderItems" class="grid grid-cols-1 gap-8"></div>
        </section>

        <!-- Favorites Section -->
        <section id="favoritesSection" class="section">
            <h2 class="text-3xl font-bold text-white text-center mb-8 sm:text-4xl section-title">Your Favorites</h2>
            <div id="favoriteItems" class="grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3"></div>
        </section>

        <!-- Order History Section -->
        <section id="orderHistorySection" class="section">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold text-white text-center sm:text-4xl section-title">Order History</h2>
                <button onclick="clearOrderHistory()" class="btn-primary"><i class="fas fa-trash-alt mr-2"></i>Clear History</button>
            </div>
            <div id="orderHistoryItems" class="grid grid-cols-1 gap-8"></div>
        </section>

        <!-- Addresses Section -->
        <section id="addressesSection" class="section">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold text-white text-center sm:text-4xl section-title">Your Addresses</h2>
                <button onclick="showAddressModal()" class="btn-primary"><i class="fas fa-plus-circle mr-2"></i>Add Address</button>
            </div>
            <div id="addressItems" class="grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3"></div>
        </section>

        <!-- Profile Section -->
        <section id="profileSection" class="section">
            <h2 class="text-3xl font-bold text-white text-center mb-8 sm:text-4xl section-title">Your Profile</h2>
            <div class="max-w-lg mx-auto profile-card">
                <div class="flex justify-center mb-6 profile-image-container">
                    <img id="profileImage" src="https://via.placeholder.com/100" alt="Profile" class="h-48 w-48 rounded-full object-cover border-4 border-ff6f61 shadow-lg">
                    <div class="profile-image-overlay">Change Image</div>
                </div>
                <div>
                    <label for="profileName" class="block text-gray-700 font-medium mb-2 text-base required">Name</label>
                    <input type="text" id="profileName" class="input-field w-full p-3 text-base" placeholder="Enter your name">
                </div>
                <div class="mt-4">
                    <label for="profileEmail" class="block text-gray-700 font-medium mb-2 text-base">Email</label>
                    <input type="email" id="profileEmail" class="input-field w-full p-3 text-base bg-gray-100" readonly>
                </div>
                <div class="mt-4">
                    <label for="profilePhone" class="block text-gray-700 font-medium mb-2 text-base">Phone</label>
                    <input type="tel" id="profilePhone" class="input-field w-full p-3 text-base bg-gray-100" readonly>
                </div>
                <div class="mt-4">
                    <label for="profileImageUpload" class="block text-gray-700 font-medium mb-2 text-base">Upload Profile Image</label>
                    <input type="file" id="profileImageUpload" class="input-field w-full p-3 text-base" accept="image/*">
                </div>
                <div class="mt-6 flex space-x-4">
                    <button id="saveProfileBtn" onclick="saveProfile()" class="btn-primary w-full"><i class="fas fa-save mr-2"></i>Save Profile</button>
                    <button onclick="resetProfileForm()" class="btn-secondary w-full"><i class="fas fa-undo mr-2"></i>Reset</button>
                </div>
            </div>
        </section>

        <!-- Contact Us Section -->
        <section id="contactSection" class="section">
            <h2 class="text-3xl font-bold text-white text-center mb-8 sm:text-4xl section-title">Contact Us</h2>
            <div class="max-w-lg mx-auto profile-card">
                <p class="text-gray-600 text-base mb-4">For support, contact us at <a href="mailto:support@delicute.com" class="text-blue-500 hover:underline">support@delicute.com</a> or call <a href="tel:+919652296548" class="text-blue-500 hover:underline">+91 9652296548</a>.</p>
                <div>
                    <label for="contactSectionSubject" class="block text-gray-700 font-medium mb-2 text-base required">Subject</label>
                    <input type="text" id="contactSectionSubject" class="input-field w-full p-3 text-base" placeholder="Enter subject">
                    <label for="contactSectionMessage" class="block text-gray-700 font-medium mb-2 mt-4 text-base required">Your Message</label>
                    <textarea id="contactSectionMessage" class="input-field w-full p-3 text-base" rows="4" placeholder="Enter your message"></textarea>
                </div>
                <div class="mt-6">
                    <button onclick="submitContactMessage()" class="btn-primary w-full"><i class="fas fa-paper-plane mr-2"></i>Send Message</button>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Configuration
        const BASE_URL = window.location.hostname === 'localhost' ? 'http://localhost:3000' : 'https://delicute.onrender.com';
        const DEFAULT_IMAGE = 'https://via.placeholder.com/300';

        // State Management
        let addresses = JSON.parse(localStorage.getItem('addresses')) || [];
        let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let userName = '';
        let isLoading = false;
        let currentRatingItemId = null;
        let currentCancelOrderId = null;
        let currentAddressId = null;
        let selectedCategory = '';
        let menuItemsData = [];

        // Utility Functions
        function sanitizeHTML(str) {
            if (!str) return '';
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function setLoading(elementId, state) {
            const element = document.getElementById(elementId);
            if (element) {
                element.disabled = state;
                element.classList.toggle('loading', state);
            }
            isLoading = state;
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            if (!toast) return;
            toast.innerHTML = `<i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'} mr-2"></i>${sanitizeHTML(message)}`;
            toast.className = `toast ${type}`;
            toast.style.display = 'flex';
            toast.style.alignItems = 'center';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'flex';
                modal.querySelector('.modal-content')?.focus();
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.style.display = 'none';
            clearModalInputs(modalId);
        }

        function clearModalInputs(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.querySelectorAll('input, textarea').forEach(input => input.value = '');
            }
        }

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            const section = document.getElementById(`${sectionId}Section`);
            if (section) section.classList.add('active');
            switch (sectionId) {
                case 'home':
                    fetchCategories();
                    fetchMenuItems();
                    fetchCoupons();
                    break;
                case 'cart':
                    loadCart();
                    loadCartAddresses();
                    break;
                case 'orders':
                    fetchOrders();
                    break;
                case 'favorites':
                    loadFavorites();
                    break;
                case 'orderHistory':
                    fetchOrderHistory();
                    break;
                case 'addresses':
                    loadAddresses();
                    break;
                case 'profile':
                    fetchUserDetails();
                    break;
                case 'contact':
                    break;
            }
            const navbarMenu = document.getElementById('navbarMenu');
            if (navbarMenu) navbarMenu.classList.remove('active');
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        }

        // Authentication
        async function checkAuth() {
            const token = localStorage.getItem('token');
            if (!token) {
                showToast('Please log in to access the dashboard.', 'error');
                setTimeout(() => window.location.href = 'index.html', 1000);
                return false;
            }
            try {
                const response = await fetch(`${BASE_URL}/api/auth/me`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (!response.ok) throw new Error('Invalid token');
                await fetchUserDetails();
                showSection('home');
                if (localStorage.getItem('darkMode') === 'true') {
                    document.body.classList.add('dark-mode');
                }
                return true;
            } catch (error) {
                console.error('Auth error:', error);
                showToast('Session expired. Please log in again.', 'error');
                localStorage.removeItem('token');
                setTimeout(() => window.location.href = 'index.html', 1000);
                return false;
            }
        }

        // User Profile
        async function fetchUserDetails() {
            const token = localStorage.getItem('token');
            setLoading('saveProfileBtn', true);
            try {
                const response = await fetch(`${BASE_URL}/api/auth/me`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();
                if (response.ok) {
                    userName = sanitizeHTML(data.name || 'Guest');
                    document.getElementById('welcomeMessage').innerHTML = `<i class="fas fa-user-circle mr-2"></i>Welcome, ${userName}!`;
                    document.getElementById('headerUserName').textContent = userName;
                    document.getElementById('profileName').value = data.name || '';
                    document.getElementById('profileEmail').value = data.email || '';
                    document.getElementById('profilePhone').value = data.phone || '';
                    const profileImageUrl = data.profileImage || DEFAULT_IMAGE;
                    document.getElementById('profileImage').src = profileImageUrl;
                    document.getElementById('headerProfileImage').src = profileImageUrl;
                    localStorage.setItem('userProfileImage', profileImageUrl);
                } else {
                    showToast(data.error || 'Failed to fetch profile.', 'error');
                }
            } catch (error) {
                console.error('Fetch user error:', error);
                showToast('Error fetching profile.', 'error');
            } finally {
                setLoading('saveProfileBtn', false);
            }
        }

        async function saveProfile() {
            if (isLoading) return;
            const token = localStorage.getItem('token');
            const name = document.getElementById('profileName')?.value.trim();
            const fileInput = document.getElementById('profileImageUpload');
            if (!name) {
                showToast('Please enter a name.', 'error');
                return;
            }
            setLoading('saveProfileBtn', true);
            const formData = new FormData();
            formData.append('name', sanitizeHTML(name));
            if (fileInput?.files[0]) {
                if (fileInput.files[0].size > 5 * 1024 * 1024) {
                    showToast('Image size should be less than 5MB.', 'error');
                    setLoading('saveProfileBtn', false);
                    return;
                }
                formData.append('profileImage', fileInput.files[0]);
            }
            try {
                const response = await fetch(`${BASE_URL}/api/auth/update`, {
                    method: 'PUT',
                    headers: { 'Authorization': `Bearer ${token}` },
                    body: formData
                });
                const data = await response.json();
                if (response.ok) {
                    showToast('Profile updated successfully!', 'success');
                    userName = sanitizeHTML(name);
                    document.getElementById('welcomeMessage').innerHTML = `<i class="fas fa-user-circle mr-2"></i>Welcome, ${userName}!`;
                    document.getElementById('headerUserName').textContent = userName;
                    if (data.profileImage) {
                        document.getElementById('profileImage').src = data.profileImage;
                        document.getElementById('headerProfileImage').src = data.profileImage;
                        localStorage.setItem('userProfileImage', data.profileImage);
                    }
                    if (fileInput) fileInput.value = '';
                } else {
                    showToast(data.error || 'Failed to update profile.', 'error');
                }
            } catch (error) {
                console.error('Update profile error:', error);
                showToast('Error updating profile.', 'error');
            } finally {
                setLoading('saveProfileBtn', false);
            }
        }

        function resetProfileForm() {
            fetchUserDetails();
            document.getElementById('profileImageUpload').value = '';
        }

        // Categories and Menu Items
        async function fetchCategories() {
            try {
                const response = await fetch(`${BASE_URL}/api/menu/categories`);
                if (!response.ok) throw new Error('Failed to fetch categories');
                const categories = await response.json();
                const categoryFilter = document.getElementById('categoryFilter');
                if (!categoryFilter) return;
                categoryFilter.innerHTML = `
                    <option value="">All Categories</option>
                    ${categories.map(category => `
                        <option value="${category}" ${selectedCategory === category ? 'selected' : ''}>${sanitizeHTML(category)}</option>
                    `).join('')}
                `;
            } catch (error) {
                console.error('Fetch categories error:', error);
                showToast('Failed to load categories.', 'error');
            }
        }

        async function fetchMenuItems() {
            setLoading('menuItems', true);
            try {
                const response = await fetch(`${BASE_URL}/api/menu`);
                if (!response.ok) throw new Error('Failed to fetch menu');
                menuItemsData = await response.json();
                filterMenuItems();
            } catch (error) {
                console.error('Fetch menu error:', error);
                const menuItemsDiv = document.getElementById('menuItems');
                if (menuItemsDiv) menuItemsDiv.innerHTML = '<div class="text-center text-red-500 bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md col-span-full"><i class="fas fa-exclamation-circle text-3xl mb-2"></i><p class="text-lg">Failed to load menu items.</p></div>';
            } finally {
                setLoading('menuItems', false);
            }
        }

        function filterMenuItems() {
            const searchQuery = document.getElementById('menuSearch')?.value.toLowerCase() || '';
            selectedCategory = document.getElementById('categoryFilter')?.value || '';
            let filteredItems = menuItemsData;
            if (searchQuery) {
                filteredItems = filteredItems.filter(item => item.name.toLowerCase().includes(searchQuery));
            }
            if (selectedCategory) {
                filteredItems = filteredItems.filter(item => item.category === selectedCategory);
            }
            const menuItemsDiv = document.getElementById('menuItems');
            if (!menuItemsDiv) return;
            if (filteredItems.length === 0) {
                menuItemsDiv.innerHTML = '<div class="text-center text-gray-600 bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md col-span-full"><i class="fas fa-utensils text-3xl mb-2"></i><p class="text-lg">No items found.</p></div>';
                return;
            }
            menuItemsDiv.innerHTML = filteredItems.map(item => `
                <div class="menu-item-card">
                    <img src="${sanitizeHTML(item.image || DEFAULT_IMAGE)}" alt="${sanitizeHTML(item.name)}" class="w-full object-cover">
                    <div class="p-4">
                        <h3 class="text-sm font-semibold item-name truncate">${sanitizeHTML(item.name)}</h3>
                        <p class="text-ff6f61 font-bold text-sm mt-1">₹${item.price.toFixed(2)}</p>
                        <div class="flex justify-between items-center mt-2">
                            <button onclick="addToCart('${item._id}')" class="btn-primary text-xs">Add to Cart</button>
                            <button onclick="toggleFavorite(${JSON.stringify({ _id: item._id, name: item.name, price: item.price, image: item.image, category: item.category })})" class="text-red-500 hover:text-red-700 text-xl">${favorites.some(fav => fav.id === item._id) ? '♥' : '♡'}</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Cart Management
        async function addToCart(itemId) {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${BASE_URL}/api/cart/add`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ itemId, quantity: 1 })
                });
                const data = await response.json();
                if (response.ok) {
                    cart = data.cart;
                    localStorage.setItem('cart', JSON.stringify(cart));
                    showToast('Item added to cart!', 'success');
                } else {
                    showToast(data.error || 'Failed to add item to cart.', 'error');
                }
            } catch (error) {
                console.error('Add to cart error:', error);
                showToast('Failed to add item to cart.', 'error');
            }
        }

        async function updateCartItem(itemId, quantity) {
            if (quantity < 1) return removeFromCart(itemId);
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${BASE_URL}/api/cart/update`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ itemId, quantity })
                });
                const data = await response.json();
                if (response.ok) {
                    cart = data.cart;
                    localStorage.setItem('cart', JSON.stringify(cart));
                    loadCart();
                } else {
                    showToast(data.error || 'Failed to update cart.', 'error');
                }
            } catch (error) {
                console.error('Update cart error:', error);
                showToast('Failed to update cart.', 'error');
            }
        }

        async function removeFromCart(itemId) {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${BASE_URL}/api/cart/remove`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ itemId })
                });
                const data = await response.json();
                if (response.ok) {
                    cart = data.cart;
                    localStorage.setItem('cart', JSON.stringify(cart));
                    showToast('Item removed from cart!', 'success');
                    loadCart();
                } else {
                    showToast(data.error || 'Failed to remove item from cart.', 'error');
                }
            } catch (error) {
                console.error('Remove from cart error:', error);
                showToast('Failed to remove item from cart.', 'error');
            }
        }

        function loadCart() {
            setLoading('cartItems', true);
            const cartItemsDiv = document.getElementById('cartItems');
            const cartTotalSpan = document.getElementById('cartTotal');
            if (!cartItemsDiv || !cartTotalSpan) return;
            if (cart.length === 0) {
                cartItemsDiv.innerHTML = `
                    <div class="text-center text-gray-600 bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md">
                        <i class="fas fa-shopping-cart text-3xl mb-2"></i>
                        <p class="text-lg">Your cart is empty.</p>
                        <button onclick="showSection('home')" class="btn-primary mt-4">Explore Menu</button>
                    </div>
                `;
                cartTotalSpan.textContent = '0.00';
                setLoading('cartItems', false);
                return;
            }
            cartItemsDiv.innerHTML = cart.map(item => `
                <div class="cart-card">
                    <div class="p-4 flex-1">
                        <h3 class="text-lg font-semibold item-name">${sanitizeHTML(item.itemId.name)}</h3>
                        <p class="text-ff6f61 font-bold mt-2">₹${(item.itemId.price * item.quantity).toFixed(2)}</p>
                        <div class="flex items-center mt-2 space-x-4">
                            <div class="flex items-center space-x-2">
                                <button onclick="updateCartItem('${item.itemId._id}', ${item.quantity - 1})" class="btn-secondary px-3">-</button>
                                <span class="text-lg">${item.quantity}</span>
                                <button onclick="updateCartItem('${item.itemId._id}', ${item.quantity + 1})" class="btn-secondary px-3">+</button>
                            </div>
                            <button onclick="removeFromCart('${item.itemId._id}')" class="btn-secondary"><i class="fas fa-trash-alt mr-2"></i>Remove</button>
                        </div>
                    </div>
                </div>
            `).join('');
            updateCartTotal();
            setLoading('cartItems', false);
        }

        function updateCartTotal() {
            const total = cart.reduce((sum, item) => sum + item.itemId.price * item.quantity, 0);
            const cartTotalSpan = document.getElementById('cartTotal');
            if (cartTotalSpan) cartTotalSpan.textContent = total.toFixed(2);
            const placeOrderBtn = document.getElementById('placeOrderBtn');
            if (placeOrderBtn) placeOrderBtn.disabled = !document.getElementById('cartAddress')?.value || cart.length === 0;
        }

        async function loadCartAddresses() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${BASE_URL}/api/addresses`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (!response.ok) throw new Error('Failed to fetch addresses');
                addresses = await response.json();
                localStorage.setItem('addresses', JSON.stringify(addresses));
                const cartAddressSelect = document.getElementById('cartAddress');
                if (cartAddressSelect) {
                    cartAddressSelect.innerHTML = `
                        <option value="">Select an address</option>
                        ${addresses.map(address => `
                            <option value="${address._id}">${sanitizeHTML(address.fullName)}, ${sanitizeHTML(address.address)}</option>
                        `).join('')}
                    `;
                }
            } catch (error) {
                console.error('Fetch addresses error:', error);
                showToast('Failed to load addresses.', 'error');
            }
        }

        async function placeOrder() {
            if (isLoading) return;
            const addressId = document.getElementById('cartAddress')?.value;
            if (!addressId) {
                showToast('Please select a delivery address.', 'error');
                return;
            }
            if (cart.length === 0) {
                showToast('Your cart is empty.', 'error');
                return;
            }
            setLoading('placeOrderBtn', true);
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${BASE_URL}/api/orders`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        addressId,
                        paymentMethod: 'Cash on Delivery',
                        items: cart.map(item => ({ itemId: item.itemId._id, quantity: item.quantity }))
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    showToast('Order placed successfully!', 'success');
                    cart = [];
                    localStorage.setItem('cart', JSON.stringify(cart));
                    loadCart();
                    showSection('orders');
                } else {
                    showToast(data.error || 'Failed to place order.', 'error');
                }
            } catch (error) {
                console.error('Place order error:', error);
                showToast('Failed to place order.', 'error');
            } finally {
                setLoading('placeOrderBtn', false);
            }
        }

        async function fetchCoupons() {
            setLoading('couponItems', true);
            try {
                const response = await fetch(`${BASE_URL}/api/coupons`, {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                });
                if (!response.ok) throw new Error('Failed to fetch coupons');
                const coupons = await response.json();
                const couponItemsDiv = document.getElementById('couponItems');
                if (!couponItemsDiv) return;
                if (coupons.length === 0) {
                    couponItemsDiv.innerHTML = '<div class="text-center text-gray-600 bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md"><i class="fas fa-ticket-alt text-3xl mb-2"></i><p class="text-lg">No coupons available.</p></div>';
                    return;
                }
                couponItemsDiv.innerHTML = coupons.map(coupon => `
                    <div class="coupon-card">
                        <img src="${sanitizeHTML(coupon.image || DEFAULT_IMAGE)}" alt="${sanitizeHTML(coupon.code)}" class="w-full object-cover">
                        <div class="p-6">
                            <h3 class="text-lg font-semibold coupon-code">${sanitizeHTML(coupon.code)}</h3>
                            <p class="text-gray-600 dark:text-gray-400 text-sm mt-2">${sanitizeHTML(coupon.description)}</p>
                            <p class="text-ff6f61 font-bold mt-2">${coupon.discount}% OFF on ${coupon.minQuantity} ${sanitizeHTML(coupon.itemCategory)} items</p>
                            <button onclick="applyCoupon('${sanitizeHTML(coupon.code)}')" class="btn-primary mt-4 w-full"><i class="fas fa-ticket-alt mr-2"></i>Apply Coupon</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Fetch coupons error:', error);
                const couponItemsDiv = document.getElementById('couponItems');
                if (couponItemsDiv) couponItemsDiv.innerHTML = '<div class="text-center text-red-500 bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md"><i class="fas fa-exclamation-circle text-3xl mb-2"></i><p class="text-lg">Failed to load coupons.</p></div>';
            } finally {
                setLoading('couponItems', false);
            }
        }

        async function applyCoupon(code = null) {
            if (isLoading) return;
            const couponCode = code || document.getElementById('couponCode')?.value.trim();
            if (!couponCode) {
                showToast('Please enter a coupon code.', 'error');
                return;
            }
            setLoading('couponModal', true);
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${BASE_URL}/api/coupons/apply`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ code: sanitizeHTML(couponCode) })
                });
                const data = await response.json();
                if (response.ok) {
                    showToast(`Coupon ${sanitizeHTML(couponCode)} applied! ${data.discount}% off on ${data.minQuantity} ${data.itemCategory} items`, 'success');
                    closeModal('couponModal');
                } else {
                    showToast(data.error || 'Invalid coupon code.', 'error');
                }
            } catch (error) {
                console.error('Apply coupon error:', error);
                showToast('Failed to apply coupon.', 'error');
            } finally {
                setLoading('couponModal', false);
            }
        }

        // Address Management
        function showAddressModal(address = null) {
            currentAddressId = address ? address._id : null;
            document.getElementById('addressModalTitle').textContent = address ? 'Edit Address' : 'Add Address';
            document.getElementById('fullName').value = address ? sanitizeHTML(address.fullName) : '';
            document.getElementById('mobileNumber').value = address ? sanitizeHTML(address.mobileNumber) : '';
            document.getElementById('houseFlatNo').value = address ? sanitizeHTML(address.houseFlatNo) : '';
            document.getElementById('floorNo').value = address ? sanitizeHTML(address.floorNo) : '';
            document.getElementById('address').value = address ? sanitizeHTML(address.address) : '';
            document.getElementById('landmark').value = address ? sanitizeHTML(address.landmark) : '';
            showModal('addressModal');
        }

        async function saveAddress() {
            if (isLoading) return;
            const fullName = document.getElementById('fullName')?.value.trim();
            const mobileNumber = document.getElementById('mobileNumber')?.value.trim();
            const houseFlatNo = document.getElementById('houseFlatNo')?.value.trim();
            const floorNo = document.getElementById('floorNo')?.value.trim();
            const address = document.getElementById('address')?.value.trim();
            const landmark = document.getElementById('landmark')?.value.trim();

            if (!fullName || !mobileNumber || !houseFlatNo || !floorNo || !address || !landmark) {
                showToast('Please fill in all required fields.', 'error');
                return;
            }

            if (!/^\d{10}$/.test(mobileNumber)) {
                showToast('Please enter a valid 10-digit mobile number.', 'error');
                return;
            }

            setLoading('saveAddressBtn', true);
            try {
                const token = localStorage.getItem('token');
                const addressData = {
                    fullName: sanitizeHTML(fullName),
                    mobileNumber: sanitizeHTML(mobileNumber),
                    houseFlatNo: sanitizeHTML(houseFlatNo),
                    floorNo: sanitizeHTML(floorNo),
                    address: sanitizeHTML(address),
                    landmark: sanitizeHTML(landmark)
                };
                const endpoint = currentAddressId ? `/api/addresses/${currentAddressId}` : '/api/addresses';
                const method = currentAddressId ? 'PUT' : 'POST';
                const response = await fetch(`${BASE_URL}${endpoint}`, {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(addressData)
                });
                const data = await response.json();
                if (response.ok) {
                    const updatedAddress = { ...addressData, _id: currentAddressId || data._id || `addr_${Date.now()}` };
                    if (currentAddressId) {
                        const index = addresses.findIndex(addr => addr._id === currentAddressId);
                        if (index !== -1) {
                            addresses[index] = updatedAddress;
                        }
                    } else {
                        addresses.push(updatedAddress);
                    }
                    localStorage.setItem('addresses', JSON.stringify(addresses));
                    showToast(`Address ${currentAddressId ? 'updated' : 'added'} successfully!`, 'success');
                    closeModal('addressModal');
                    loadAddresses();
                } else {
                    showToast(data.error || 'Failed to save address.', 'error');
                }
            } catch (error) {
                console.error('Save address error:', error);
                showToast('Failed to save address.', 'error');
            } finally {
                setLoading('saveAddressBtn', false);
            }
        }

        async function deleteAddress(addressId) {
            if (!addressId || addressId === 'undefined') {
                showToast('Invalid address ID.', 'error');
                return;
            }
            if (!confirm('Are you sure you want to delete this address?')) return;
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${BASE_URL}/api/addresses/${encodeURIComponent(addressId)}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();
                if (response.ok) {
                    addresses = addresses.filter(addr => addr._id !== addressId);
                    localStorage.setItem('addresses', JSON.stringify(addresses));
                    showToast('Address deleted successfully!', 'success');
                    loadAddresses();
                } else {
                    showToast(data.error || 'Failed to delete address.', 'error');
                }
            } catch (error) {
                console.error('Delete address error:', error);
                showToast('Failed to delete address.', 'error');
            }
        }

        async function loadAddresses() {
            setLoading('addressItems', true);
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${BASE_URL}/api/addresses`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (!response.ok) throw new Error('Failed to fetch addresses');
                addresses = await response.json();
                localStorage.setItem('addresses', JSON.stringify(addresses));
                const addressItemsDiv = document.getElementById('addressItems');
                if (addressItemsDiv) {
                    if (addresses.length === 0) {
                        addressItemsDiv.innerHTML = `
                            <div class="text-center text-gray-600 bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md">
                                <i class="fas fa-map-marker-alt text-3xl mb-2"></i>
                                <p class="text-lg">No addresses saved.</p>
                                <button onclick="showAddressModal()" class="btn-primary mt-4">Add Address</button>
                            </div>
                        `;
                    } else {
                        addressItemsDiv.innerHTML = addresses.map(address => `
                            <div class="address-card">
                                <p class="address-header"><i class="fas fa-user mr-2"></i>${sanitizeHTML(address.fullName)}</p>
                                <p class="address-details"><i class="fas fa-phone mr-2"></i>${sanitizeHTML(address.mobileNumber)}</p>
                                <p class="address-details"><i class="fas fa-home mr-2"></i>${sanitizeHTML(address.houseFlatNo)}, Floor ${sanitizeHTML(address.floorNo)}</p>
                                <p class="address-details"><i class="fas fa-map-marker-alt mr-2"></i>${sanitizeHTML(address.address)}</p>
                                <p class="address-details"><i class="fas fa-landmark mr-2"></i>${sanitizeHTML(address.landmark)}</p>
                                <div class="address-actions">
                                    <button onclick="showAddressModal(${JSON.stringify(address).replace(/"/g, '"')})" class="btn-primary"><i class="fas fa-edit mr-2"></i>Edit</button>
                                    <button onclick="deleteAddress('${sanitizeHTML(address._id)}')" class="btn-secondary"><i class="fas fa-trash-alt mr-2"></i>Delete</button>
                                </div>
                            </div>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Fetch addresses error:', error);
                showToast('Failed to load addresses.', 'error');
            } finally {
                setLoading('addressItems', false);
            }
        }

        // Orders Management
        async function fetchOrders() {
            setLoading('orderItems', true);
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${BASE_URL}/api/orders/active`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const orders = await response.json();
                const orderItemsDiv = document.getElementById('orderItems');
                if (!orderItemsDiv) return;
                if (orders.length === 0) {
                    orderItemsDiv.innerHTML = `
                        <div class="text-center text-gray-600 bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md">
                            <i class="fas fa-box-open text-3xl mb-2"></i>
                            <p class="text-lg">No active orders.</p>
                        </div>
                    `;
                    return;
                }
                orderItemsDiv.innerHTML = orders.map(order => `
                    <div class="cart-card">
                        <div class="p-4 flex-1">
                            <h3 class="text-lg font-semibold">Order ID: ${sanitizeHTML(order.orderId)}</h3>
                            <p class="text-gray-600 dark:text-gray-400 text-sm mt-1">Placed on: ${new Date(order.createdAt).toLocaleString()}</p>
                            <p class="text-gray-600 dark:text-gray-400 text-sm">Total: ₹${order.total.toFixed(2)}</p>
                            <p class="text-gray-600 dark:text-gray-400 text-sm">Status: ${sanitizeHTML(order.status)}</p>
                            <div class="mt-4 flex space-x-2">
                                <button onclick="showOrderDetails('${order._id}')" class="btn-primary"><i class="fas fa-eye mr-2"></i>View Details</button>
                                ${order.status === 'Pending' ? `
                                    <button onclick="showCancelOrderModal('${order._id}')" class="btn-secondary"><i class="fas fa-times-circle mr-2"></i>Cancel</button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Fetch orders error:', error);
                showToast('Failed to load orders.', 'error');
            } finally {
                setLoading('orderItems', false);
            }
        }

        async function showOrderDetails(orderId) {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${BASE_URL}/api/orders/${orderId}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const order = await response.json();
                if (response.ok) {
                    document.getElementById('orderConfirmationDetails').innerHTML = `
                        <p><strong>Order ID:</strong> ${sanitizeHTML(order.orderId)}</p>
                        <p><strong>Placed on:</strong> ${new Date(order.createdAt).toLocaleString()}</p>
                        <p><strong>Total:</strong> ₹${order.total.toFixed(2)}</p>
                        <p><strong>Status:</strong> ${sanitizeHTML(order.status)}</p>
                        <p><strong>Items:</strong></p>
                        <ul class="list-disc pl-5">
                            ${order.items.map(item => `
                                <li>${sanitizeHTML(item.itemId.name)} x${item.quantity} - ₹${(item.itemId.price * item.quantity).toFixed(2)}</li>
                            `).join('')}
                        </ul>
                        <p><strong>Delivery Address:</strong> ${sanitizeHTML(order.address.fullName)}, ${sanitizeHTML(order.address.address)}, ${sanitizeHTML(order.address.landmark)}</p>
                        <p><strong>Payment Method:</strong> ${sanitizeHTML(order.paymentMethod)}</p>
                    `;
                    showModal('orderConfirmationModal');
                } else {
                    showToast(order.error || 'Failed to fetch order details.', 'error');
                }
            } catch (error) {
                console.error('Fetch order details error:', error);
                showToast('Failed to fetch order details.', 'error');
            }
        }

        function showCancelOrderModal(orderId) {
            currentCancelOrderId = orderId;
            document.getElementById('cancelReason').value = '';
            showModal('cancelOrderModal');
        }

        async function showOrderDetails(orderId) {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${BASE_URL}/api/orders/${orderId}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const order = await response.json();
                if (response.ok) {
                    document.getElementById('orderConfirmationDetails').innerHTML = `
                        <p><strong>Order ID:</strong> ${sanitizeHTML(order.orderId)}</p>
                        <p><strong>Placed on:</strong> ${new Date(order.createdAt).toLocaleString()}</p>
                        <p><strong>Total:</strong> ₹${order.total.toFixed(2)}</p>
                        <p><strong>Status:</strong> ${sanitizeHTML(order.status)}</p>
                        <p><strong>Items:</strong></p>
                        <ul class="list-disc pl-5">
                            ${order.items.map(item => `
                                <li>${sanitizeHTML(item.itemId.name)} x${item.quantity} - ₹${(item.itemId.price * item.quantity).toFixed(2)}</li>
                            `).join('')}
                        </ul>
                        <p><strong>Delivery Address:</strong> ${sanitizeHTML(order.address.fullName)}, ${sanitizeHTML(order.address.address)}, ${sanitizeHTML(order.address.landmark)}</p>
                        <p><strong>Payment Method:</strong> ${sanitizeHTML(order.paymentMethod)}</p>
                    `;
                    showModal('orderConfirmationModal');
                } else {
                    showToast(order.error || 'Failed to fetch order details.', 'error');
                }
            } catch (error) {
                console.error('Fetch order details error:', error);
                showToast('Failed to fetch order details.', 'error');
            }
        }

        function showCancelOrderModal(orderId) {
            currentCancelOrderId = orderId;
            document.getElementById('cancelReason').value = '';
            showModal('cancelOrderModal');
        }

        async function submitCancelOrder() {
            if (isLoading) return;
            const reason = document.getElementById('cancelReason')?.value.trim();
            if (!reason) {
                showToast('Please provide a reason for cancellation.', 'error');
                return;
            }
            setLoading('cancelOrderModal', true);
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${BASE_URL}/api/orders/${currentCancelOrderId}/cancel`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ reason: sanitizeHTML(reason) })
                });
                const data = await response.json();
                if (response.ok) {
                    showToast('Order cancelled successfully!', 'success');
                    closeModal('cancelOrderModal');
                    fetchOrders();
                } else {
                    showToast(data.error || 'Failed to cancel order.', 'error');
                }
            } catch (error) {
                console.error('Cancel order error:', error);
                showToast('Failed to cancel order.', 'error');
            } finally {
                setLoading('cancelOrderModal', false);
            }
        }

        // Favorites Management
        function toggleFavorite(item) {
            const index = favorites.findIndex(fav => fav.id === item._id);
            if (index !== -1) {
                favorites.splice(index, 1);
                showToast(`${sanitizeHTML(item.name)} removed from favorites!`, 'success');
            } else {
                favorites.push({
                    id: item._id,
                    name: item.name,
                    price: item.price,
                    image: item.image,
                    category: item.category
                });
                showToast(`${sanitizeHTML(item.name)} added to favorites!`, 'success');
            }
            localStorage.setItem('favorites', JSON.stringify(favorites));
            loadFavorites();
            filterMenuItems();
        }

        function loadFavorites() {
            const favoriteItemsDiv = document.getElementById('favoriteItems');
            if (!favoriteItemsDiv) return;
            if (favorites.length === 0) {
                favoriteItemsDiv.innerHTML = `
                    <div class="text-center text-gray-600 bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md">
                        <i class="fas fa-heart text-3xl mb-2"></i>
                        <p class="text-lg">No favorite items.</p>
                        <button onclick="showSection('home')" class="btn-primary mt-4">Explore Menu</button>
                    </div>
                `;
                return;
            }
            favoriteItemsDiv.innerHTML = favorites.map(item => `
                <div class="menu-item-card">
                    <img src="${sanitizeHTML(item.image || DEFAULT_IMAGE)}" alt="${sanitizeHTML(item.name)}" class="w-full object-cover">
                    <div class="p-4">
                        <h3 class="text-lg font-semibold item-name">${sanitizeHTML(item.name)}</h3>
                        <p class="text-ff6f61 font-bold mt-2">₹${item.price.toFixed(2)}</p>
                        <div class="flex justify-between items-center mt-2">
                            <button onclick="addToCart('${item.id}')" class="btn-primary">Add to Cart</button>
                            <button onclick="toggleFavorite(${JSON.stringify(item).replace(/"/g, '"')})" class="text-red-500 hover:text-red-700 text-xl">♥</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Order History Management
        async function fetchOrderHistory() {
            setLoading('orderHistoryItems', true);
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${BASE_URL}/api/orders/history`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const orders = await response.json();
                const orderHistoryItemsDiv = document.getElementById('orderHistoryItems');
                if (!orderHistoryItemsDiv) return;
                if (orders.length === 0) {
                    orderHistoryItemsDiv.innerHTML = `
                        <div class="text-center text-gray-600 bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md">
                            <i class="fas fa-history text-3xl mb-2"></i>
                            <p class="text-lg">No order history.</p>
                        </div>
                    `;
                    return;
                }
                orderHistoryItemsDiv.innerHTML = orders.map(order => `
                    <div class="cart-card">
                        <div class="p-4 flex-1">
                            <h3 class="text-lg font-semibold">Order ID: ${sanitizeHTML(order.orderId)}</h3>
                            <p class="text-gray-600 dark:text-gray-400 text-sm mt-1">Placed on: ${new Date(order.createdAt).toLocaleString()}</p>
                            <p class="text-gray-600 dark:text-gray-400 text-sm">Total: ₹${order.total.toFixed(2)}</p>
                            <p class="text-gray-600 dark:text-gray-400 text-sm">Status: ${sanitizeHTML(order.status)}</p>
                            <button onclick="showOrderDetails('${order._id}')" class="btn-primary mt-4"><i class="fas fa-eye mr-2"></i>View Details</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Fetch order history error:', error);
                showToast('Failed to load order history.', 'error');
            } finally {
                setLoading('orderHistoryItems', false);
            }
        }

        async function fetchOrderHistory() {
  try {
    const response = await fetch(`${API_URL}/orders/history`, {
      headers: { Authorization: `Bearer ${token}` },
    });
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    const orders = await response.json();
    // Ensure orders is an array
    if (!Array.isArray(orders)) {
      console.error('Expected array, got:', orders);
      orderHistoryList.innerHTML = '<p>No order history found.</p>';
      return;
    }
    orderHistoryList.innerHTML = orders.length
      ? orders.map(
          (order) => `
            <div class="order-card">
              <h3>Order #${order.orderId}</h3>
              <p>Date: ${new Date(order.createdAt).toLocaleDateString()}</p>
              <p>Total: ₹${order.total.toFixed(2)}</p>
              <p>Status: ${order.status}</p>
              <button onclick="viewOrderDetails('${order._id}')">View Details</button>
            </div>
          `
        ).join('')
      : '<p>No order history found.</p>';
  } catch (error) {
    console.error('Fetch order history error:', error);
    orderHistoryList.innerHTML = '<p>Error loading order history.</p>';
  }
}

        // Ratings and Reviews
        function showRateModal(itemId) {
            currentRatingItemId = itemId;
            document.getElementById('rating').value = '';
            document.getElementById('review').value = '';
            showModal('rateModal');
        }

        async function submitRating() {
            if (isLoading) return;
            const rating = parseInt(document.getElementById('rating')?.value);
            const review = document.getElementById('review')?.value.trim();
            if (!rating || rating < 1 || rating > 5) {
                showToast('Please enter a valid rating between 1 and 5.', 'error');
                return;
            }
            setLoading('rateModal', true);
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${BASE_URL}/api/ratings`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        itemId: currentRatingItemId,
                        rating,
                        review: sanitizeHTML(review)
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    showToast('Rating submitted successfully!', 'success');
                    closeModal('rateModal');
                } else {
                    showToast(data.error || 'Failed to submit rating.', 'error');
                }
            } catch (error) {
                console.error('Submit rating error:', error);
                showToast('Failed to submit rating.', 'error');
            } finally {
                setLoading('rateModal', false);
            }
        }

        async function submitContactMessage() {
  const subject = document.getElementById('contactSubject').value;
  const message = document.getElementById('contactMessage').value;
  if (!subject.trim() || !message.trim()) {
    alert('Please fill in both subject and message fields.');
    return;
  }
  try {
    const response = await fetch(`${API_URL}/contact`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        Authorization: `Bearer ${token}`,
      },
      body: JSON.stringify({ subject, message }),
    });
    const data = await response.json();
    if (!response.ok) {
      throw new Error(data.error || 'Failed to send message');
    }
    alert(data.message);
    document.getElementById('contactSubject').value = '';
    document.getElementById('contactMessage').value = '';
  } catch (error) {
    console.error('Submit contact error:', error);
    alert('Error sending message: ' + error.message);
  }
}

        // Logout
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('userProfileImage');
            localStorage.removeItem('addresses');
            localStorage.removeItem('favorites');
            localStorage.removeItem('cart');
            showToast('Logged out successfully!', 'success');
            setTimeout(() => window.location.href = 'index.html', 1000);
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', async () => {
            const menuToggle = document.getElementById('menuToggle');
            const navbarMenu = document.getElementById('navbarMenu');
            if (menuToggle && navbarMenu) {
                menuToggle.addEventListener('click', () => {
                    navbarMenu.classList.toggle('active');
                });
            }
            await checkAuth();
        });

        // API Endpoints Documentation
        /*
        1. Authentication
        - GET /api/auth/me - Fetch user details
        - PUT /api/auth/update - Update user profile (name, profileImage)

        2. Menu
        - GET /api/menu - Fetch all menu items
        - GET /api/menu/categories - Fetch all categories

        3. Cart
        - POST /api/cart/add - Add item to cart (itemId, quantity)
        - PUT /api/cart/update - Update cart item quantity (itemId, quantity)
        - DELETE /api/cart/remove - Remove item from cart (itemId)

        4. Orders
        - POST /api/orders - Place new order (addressId, paymentMethod, items)
        - GET /api/orders/active - Fetch active orders
        - GET /api/orders/:id - Fetch order details
        - PUT /api/orders/:id/cancel - Cancel order (reason)
        - GET /api/orders/history - Fetch order history
        - DELETE /api/orders/history/clear - Clear order history

        5. Coupons
        - GET /api/coupons - Fetch available coupons
        - POST /api/coupons/apply - Apply coupon (code)

        6. Addresses
        - GET /api/addresses - Fetch all addresses
        - POST /api/addresses - Add new address
        - PUT /api/addresses/:id - Update address
        - DELETE /api/addresses/:id - Delete address

        7. Ratings
        - POST /api/ratings - Submit rating (itemId, rating, review)

        8. Contact
        - POST /api/contact - Submit contact message (subject, message)
        */
    </script>
</body>
</html>